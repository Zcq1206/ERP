"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_cell=_interopRequireDefault(require("./cell")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_util=require("./util"),_utils=_interopRequireWildcard(require("../../tools/utils")),_dom=_interopRequireWildcard(require("../../tools/dom")),_formats=require("../../v-x-e-table/src/formats"),_log=require("../../tools/log");function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(e){return e?r:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var r=_getRequireWildcardCache(t);if(r&&r.has(e))return r.get(e);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var o=l?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=e[n]}return i.default=e,r&&r.set(e,i),i}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var setCellValue=_utils.default.setCellValue,hasChildrenList=_utils.default.hasChildrenList,getColumnList=_utils.default.getColumnList,calcHeight=_dom.default.calcHeight,hasClass=_dom.default.hasClass,addClass=_dom.default.addClass,removeClass=_dom.default.removeClass,getEventTargetNode=_dom.default.getEventTargetNode,isNodeElement=_dom.default.isNodeElement,isWebkit=_dom.browse["-webkit"]&&!_dom.browse.edge,debounceScrollYDuration=_dom.browse.msie?80:20,resizableStorageKey="VXE_TABLE_CUSTOM_COLUMN_WIDTH",visibleStorageKey="VXE_TABLE_CUSTOM_COLUMN_VISIBLE";function getRowUniqueId(){return _xeUtils.default.uniqueId("row_")}function eqCellValue(e,t,r){var i=_xeUtils.default.get(e,r),l=_xeUtils.default.get(t,r);return!(!(0,_utils.eqEmptyValue)(i)||!(0,_utils.eqEmptyValue)(l))||(_xeUtils.default.isString(i)||_xeUtils.default.isNumber(i)?""+i==""+l:_xeUtils.default.isEqual(i,l))}function getNextSortOrder(e,t){var r=e.sortOpts.orders,i=t.order||null,l=r.indexOf(i)+1;return r[l<r.length?l:0]}function getCustomStorageMap(e){var t=_conf.default.version,r=_xeUtils.default.toStringJSON(localStorage.getItem(e));return r&&r._v===t?r:{_v:t}}function getRecoverRow(e,t){var r=e.fullAllDataRowMap;return t.filter(function(e){return r.has(e)})}function handleReserveRow(e,t){var r=e.fullDataRowIdData,i=[];return _xeUtils.default.each(t,function(e,t){r[t]&&-1===i.indexOf(r[t].row)&&i.push(r[t].row)}),i}function computeVirtualX(e){var t=e.$refs,r=e.visibleColumn,i=t.tableBody,l=i?i.$el:null;if(l){for(var n=l.scrollLeft,o=n+l.clientWidth,a=-1,s=0,u=0,c=0,h=r.length;c<h&&(s+=r[c].renderWidth,-1===a&&n<s&&(a=c),!(0<=a&&(u++,o<s)));c++);return{toVisibleIndex:Math.max(0,a),visibleSize:Math.max(8,u)}}return{toVisibleIndex:0,visibleSize:8}}function computeVirtualY(e){var t=e.$refs,r=e.vSize,i=e.rowHeightMaps,l=t.tableHeader,n=t.tableBody,o=n?n.$el:null;if(o){var a,s=l?l.$el:null,u=0;return!(a=o.querySelector("tr"))&&s&&(a=s.querySelector("tr")),a&&(u=a.clientHeight),u||(u=i[r||"default"]),{rowHeight:u,visibleSize:Math.max(8,Math.ceil(o.clientHeight/u)+2)}}return{rowHeight:0,visibleSize:8}}function calculateMergerOffserIndex(e,t,r){for(var i=0,l=e.length;i<l;i++){var n=e[i],o=t.startIndex,a=t.endIndex,s=n[r],u=s+n[r+"span"];s<o&&o<u&&(t.startIndex=s),s<a&&a<u&&(t.endIndex=u),t.startIndex===o&&t.endIndex===a||(i=-1)}}function setMerges(e,t,u,c){if(t){var r=e.treeConfig,h=e.visibleColumn;if(r)throw new Error(_utils.default.getLog("vxe.error.noTree",["merge-footer-items"]));_xeUtils.default.isArray(t)||(t=[t]),t.forEach(function(e){var t=e.row,r=e.col,i=e.rowspan,l=e.colspan;if(c&&_xeUtils.default.isNumber(t)&&(t=c[t]),_xeUtils.default.isNumber(r)&&(r=h[r]),(c?t:_xeUtils.default.isNumber(t))&&r&&(i||l)&&(i=_xeUtils.default.toNumber(i)||1,l=_xeUtils.default.toNumber(l)||1,1<i||1<l)){var n=_xeUtils.default.findIndexOf(u,function(e){return e._row===t&&e._col===r}),o=u[n];if(o)o.rowspan=i,o.colspan=l,o._rowspan=i,o._colspan=l;else{var a=c?c.indexOf(t):t,s=h.indexOf(r);u.push({row:a,col:s,rowspan:i,colspan:l,_row:t,_col:r,_rowspan:i,_colspan:l})}}})}}function removeMerges(e,t,n,o){var a=[];if(t){var r=e.treeConfig,s=e.visibleColumn;if(r)throw new Error(_utils.default.getLog("vxe.error.noTree",["merge-cells"]));_xeUtils.default.isArray(t)||(t=[t]),t.forEach(function(e){var t=e.row,r=e.col;o&&_xeUtils.default.isNumber(t)&&(t=o[t]),_xeUtils.default.isNumber(r)&&(r=s[r]);var i=_xeUtils.default.findIndexOf(n,function(e){return e._row===t&&e._col===r});if(-1<i){var l=n.splice(i,1);a.push(l[0])}})}return a}function clearAllSort(e){e.tableFullColumn.forEach(function(e){e.order=null})}function getOrderField(r,i){var l=i.sortBy,n=i.sortType;return function(e){var t;return t=l?_xeUtils.default.isFunction(l)?l({row:e,column:i}):_xeUtils.default.get(e,l):r.getCellLabel(e,i),n&&"auto"!==n?"number"===n?_xeUtils.default.toNumber(t):"string"===n?_xeUtils.default.toValueString(t):t:isNaN(t)?t:_xeUtils.default.toNumber(t)}}var Methods={callSlot:function(e,t,r,i){if(e){var l=this.$xegrid;if(l)return l.callSlot(e,t,r,i);if(_xeUtils.default.isFunction(e))return e.call(this,t,r,i)}return[]},getParentElem:function(){var e=this.$el,t=this.$xegrid;return t?t.$el.parentNode:e.parentNode},getParentHeight:function(){var e=this.$el,t=this.$xegrid,r=this.height,i=e.parentNode,l="auto"===r?(0,_dom.getPaddingTopBottomSize)(i):0;return Math.floor(t?t.getParentHeight():_xeUtils.default.toNumber(getComputedStyle(i).height)-l)},getExcludeHeight:function(){var e=this.$xegrid;return e?e.getExcludeHeight():0},clearAll:function(){return(0,_util.clearTableAllStatus)(this)},syncData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){var e=this,t=this.scrollXLoad,r=this.scrollYLoad;return this.handleTableData(!0).then(function(){if(e.updateFooter(),e.checkSelectionStatus(),t||r)return t&&e.updateScrollXSpace(),r&&e.updateScrollYSpace(),e.refreshScroll()}).then(function(){return e.updateCellAreas(),e.recalculate(!0)}).then(function(){setTimeout(function(){return e.recalculate()},50)})},handleTableData:function(e){var l=this,t=this.scrollYLoad,r=this.scrollYStore,n=this.fullDataRowIdData,i=this.afterFullData;e&&(this.updateAfterFullData(),i=this.handleVirtualTreeToList());var o=t?i.slice(r.startIndex,r.endIndex):i.slice(0);return o.forEach(function(e,t){var r=(0,_util.getRowid)(l,e),i=n[r];i&&(i.$index=t)}),this.tableData=o,this.$nextTick()},updateScrollYStatus:function(e){var t=this.treeConfig,r=this.treeOpts,i=this.sYOpts,l=(r.transform||!t)&&!!i.enabled&&-1<i.gt&&i.gt<e.length;return this.scrollYLoad=l},loadTableData:function(e){var t=this,r=this.keepSource,i=this.treeConfig,l=this.treeOpts,n=this.editStore,o=this.scrollYStore,a=this.scrollXStore,s=this.lastScrollLeft,u=this.lastScrollTop,c=this.scrollYLoad,h=[],d=e?e.slice(0):[];i&&(l.transform?("development"===process.env.NODE_ENV&&(l.rowField||(0,_log.errLog)("vxe.error.reqProp",["table.tree-config.rowField"]),l.parentField||(0,_log.errLog)("vxe.error.reqProp",["table.tree-config.parentField"]),l.children||(0,_log.errLog)("vxe.error.reqProp",["tree-config.children"]),l.mapChildren||(0,_log.errLog)("vxe.error.reqProp",["tree-config.mapChildren"]),l.children===l.mapChildren&&(0,_log.errLog)("vxe.error.errConflicts",["tree-config.children","tree-config.mapChildren"]),d.forEach(function(e){e[l.children]&&e[l.children].length&&(0,_log.warnLog)("vxe.error.errConflicts",["tree-config.transform","row.".concat(l.children)])})),d=(h=_xeUtils.default.toArrayTree(d,{key:l.rowField,parentKey:l.parentField,children:l.children,mapChildren:l.mapChildren})).slice(0)):h=d.slice(0)),o.startIndex=0,o.endIndex=1,a.startIndex=0,a.endIndex=1,n.insertList=[],n.removeList=[];var f=this.updateScrollYStatus(d);return this.scrollYLoad=f,this.tableFullData=d,this.tableFullTreeData=h,this.cacheRowMap(!0),this.tableSynchData=e,r&&(this.tableSourceData=_xeUtils.default.clone(d,!0)),"development"===process.env.NODE_ENV&&f&&(this.height||this.maxHeight||(0,_log.errLog)("vxe.error.reqProp",["table.height | table.max-height | table.scroll-y={enabled: false}"]),this.showOverflow||(0,_log.warnLog)("vxe.error.reqProp",["table.show-overflow"]),this.spanMethod&&(0,_log.warnLog)("vxe.error.scrollErrProp",["table.span-method"])),this.clearCellAreas&&this.mouseConfig&&(this.clearCellAreas(),this.clearCopyCellArea()),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),this.updateFooter(),this.$nextTick().then(function(){t.updateHeight(),t.updateStyle()}).then(function(){t.computeScrollLoad()}).then(function(){return f&&(o.endIndex=o.visibleSize),t.handleReserveStatus(),t.checkSelectionStatus(),new Promise(function(e){t.$nextTick().then(function(){return t.recalculate()}).then(function(){c===f?(0,_util.restoreScrollLocation)(t,s,u).then(e):setTimeout(function(){return(0,_util.restoreScrollLocation)(t,s,u).then(e)})})})})},loadData:function(e){var t=this,r=this.inited,i=this.initStatus;return this.loadTableData(e).then(function(){return t.inited=!0,t.initStatus=!0,i||t.handleLoadDefaults(),r||t.handleInitDefaults(),t.recalculate()})},reloadData:function(e){var t=this,r=this.inited;return this.clearAll().then(function(){return t.inited=!0,t.initStatus=!0,t.loadTableData(e)}).then(function(){return t.handleLoadDefaults(),r||t.handleInitDefaults(),t.recalculate()})},reloadRow:function(e,t,r){var i=this.keepSource,l=this.tableSourceData,n=this.tableData;if(i){var o=l[this.getRowIndex(e)];if(o&&e)if(r){var a=_xeUtils.default.get(t||e,r);_xeUtils.default.set(e,r,a),_xeUtils.default.set(o,r,a)}else{var s=_xeUtils.default.clone(_objectSpread({},t),!0);_xeUtils.default.destructuring(o,Object.assign(e,s))}this.tableData=n.slice(0)}else"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.reqProp",["keep-source"]);return this.$nextTick()},loadColumn:function(e){var t=this,r=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},{children:"children"});return this.handleColumn(r)},reloadColumn:function(e){var t=this;return this.clearAll().then(function(){return t.loadColumn(e)})},handleColumn:function(e){var t=this;this.collectColumn=e;var r=getColumnList(e);return this.tableFullColumn=r,this.cacheColumnMap(),this.restoreCustomStorage(),this.parseColumns().then(function(){t.scrollXLoad&&t.loadScrollXData(!0)}),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),"development"===process.env.NODE_ENV&&(this.scrollXLoad||this.scrollYLoad)&&this.expandColumn&&(0,_log.warnLog)("vxe.error.scrollErrProp",["column.type=expand"]),this.$nextTick().then(function(){return t.$toolbar&&t.$toolbar.syncUpdate({collectColumn:e,$table:t}),t.recalculate()})},cacheRowMap:function(c){var h=this,d=this.treeConfig,f=this.treeOpts,e=this.tableFullData,g=this.fullDataRowMap,v=this.fullAllDataRowMap,t=this.tableFullTreeData,p=this.fullDataRowIdData,x=this.fullAllDataRowIdData,m=(0,_util.getRowkey)(this),w=d&&f.lazy,r=function(e,t,r,i,l,n){var o=(0,_util.getRowid)(h,e),a=d&&i?(0,_util.toTreePathSeq)(i):t+1,s=n?n.length-1:0;(0,_utils.eqEmptyValue)(o)&&(o=getRowUniqueId(),_xeUtils.default.set(e,m,o)),w&&e[f.hasChild]&&_xeUtils.default.isUndefined(e[f.children])&&(e[f.children]=null);var u={row:e,rowid:o,seq:a,index:d&&l?-1:t,_index:-1,$index:-1,items:r,parent:l,level:s};c&&(p[o]=u,g.set(e,u)),x[o]=u,v.set(e,u)};c&&(p=this.fullDataRowIdData={},g.clear()),x=this.fullAllDataRowIdData={},v.clear(),d?_xeUtils.default.eachTree(t,r,f):e.forEach(r)},loadTreeChildren:function(i,e){var s=this,l=this.keepSource,n=this.tableSourceData,o=this.treeOpts,u=this.fullDataRowIdData,c=this.fullDataRowMap,h=this.fullAllDataRowMap,d=this.fullAllDataRowIdData,a=o.transform,f=o.children,g=o.mapChildren,t=d[(0,_util.getRowid)(this,i)],v=t?t.level:0;return this.createData(e).then(function(e){if(l){var t=(0,_util.getRowid)(s,i),r=_xeUtils.default.findTree(n,function(e){return t===(0,_util.getRowid)(s,e)},o);r&&(r.item[f]=_xeUtils.default.clone(e,!0))}return _xeUtils.default.eachTree(e,function(e,t,r,i,l,n){var o=(0,_util.getRowid)(s,e),a={row:e,rowid:o,seq:-1,index:t,_index:-1,$index:-1,items:r,parent:l,level:v+n.length};u[o]=a,c.set(e,a),d[o]=a,h.set(e,a)},o),i[f]=e,a&&(i[g]=e),s.updateAfterDataIndex(),e})},cacheColumnMap:function(){var h,d,f,g,v,p=this,e=this.tableFullColumn,t=this.collectColumn,x=this.fullColumnMap,r=this.showOverflow,m=this.fullColumnIdData={},w=this.fullColumnFieldData={},i=t.some(hasChildrenList),b=!!r,o=function(e,t,r,i,l){var n=e.id,o=e.property,a=e.fixed,s=e.type,u=e.treeNode,c={column:e,colid:n,index:t,items:r,parent:l};o&&("development"===process.env.NODE_ENV&&w[o]&&(0,_log.warnLog)("vxe.error.colRepet",["field",o]),w[o]=c),!v&&a&&(v=a),u?("development"===process.env.NODE_ENV&&d&&(0,_log.warnLog)("vxe.error.colRepet",["tree-node",u]),d||(d=e)):"expand"===s&&("development"===process.env.NODE_ENV&&h&&(0,_log.warnLog)("vxe.error.colRepet",["type",s]),h||(h=e)),"development"===process.env.NODE_ENV&&("checkbox"===s?(f&&(0,_log.warnLog)("vxe.error.colRepet",["type",s]),f||(f=e)):"radio"===s&&(g&&(0,_log.warnLog)("vxe.error.colRepet",["type",s]),g||(g=e))),"development"===process.env.NODE_ENV&&(p.showOverflow&&!1===e.showOverflow&&(0,_log.warnLog)("vxe.error.errConflicts",["table.show-overflow=".concat(p.showOverflow),"column.show-overflow=".concat(e.showOverflow)]),p.showHeaderOverflow&&!1===e.showHeaderOverflow&&(0,_log.warnLog)("vxe.error.errConflicts",["table.show-header-overflow=".concat(p.showHeaderOverflow),"column.show-header-overflow=".concat(e.showHeaderOverflow)]),p.showFooterOverflow&&!1===e.showFooterOverflow&&(0,_log.warnLog)("vxe.error.errConflicts",["table.show-footer-overflow=".concat(p.showFooterOverflow),"column.show-footer-overflow=".concat(e.showFooterOverflow)])),b&&!1===e.showOverflow&&(b=!1),m[n]&&(0,_log.errLog)("vxe.error.colRepet",["colId",n]),m[n]=c,x.set(e,c)};x.clear(),i?_xeUtils.default.eachTree(t,function(e,t,r,i,l,n){e.level=n.length,o(e,t,r,0,l)}):e.forEach(o),"development"===process.env.NODE_ENV&&h&&this.mouseOpts.area&&(0,_log.errLog)("vxe.error.errConflicts",["mouse-config.area","column.type=expand"]),this.isGroup=i,this.treeNodeColumn=d,this.expandColumn=h,this.isAllOverflow=b},getRowNode:function(e){if(e){var t=this.fullAllDataRowIdData[e.getAttribute("rowid")];if(t)return{rowid:t.rowid,item:t.row,index:t.index,items:t.items,parent:t.parent}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData[e.getAttribute("colid")];if(t)return{colid:t.colid,item:t.column,index:t.index,items:t.items,parent:t.parent}}return null},getRowSeq:function(e){var t=this.fullDataRowIdData;if(e){var r=t[(0,_util.getRowid)(this,e)];if(r)return r.seq}return-1},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},getVTRowIndex:function(e){return this.afterFullData.indexOf(e)},_getRowIndex:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["_getRowIndex","getVTRowIndex"]),this.getVTRowIndex(e)},getVMRowIndex:function(e){return this.tableData.indexOf(e)},$getRowIndex:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["$getRowIndex","getVMRowIndex"]),this.getVMRowIndex(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},getVTColumnIndex:function(e){return this.visibleColumn.indexOf(e)},_getColumnIndex:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["_getColumnIndex","getVTColumnIndex"]),this.getVTColumnIndex(e)},getVMColumnIndex:function(e){return this.tableColumn.indexOf(e)},$getColumnIndex:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["$getColumnIndex","getVMColumnIndex"]),this.getVMColumnIndex(e)},isSeqColumn:function(e){return e&&"seq"===e.type},defineField:function(n){var e=this.radioOpts,t=this.checkboxOpts,r=this.treeConfig,i=this.treeOpts,l=this.expandOpts,o=(0,_util.getRowkey)(this);return this.tableFullColumn.forEach(function(e){var t=e.property,r=e.editRender;if(t&&!_xeUtils.default.has(n,t)){var i=null;if(r){var l=r.defaultValue;_xeUtils.default.isFunction(l)?i=l({column:e}):_xeUtils.default.isUndefined(l)||(i=l)}_xeUtils.default.set(n,t,i)}}),[e.labelField,t.checkField,t.labelField,l.labelField].forEach(function(e){e&&(0,_utils.eqEmptyValue)(_xeUtils.default.get(n,e))&&_xeUtils.default.set(n,e,null)}),r&&i.lazy&&_xeUtils.default.isUndefined(n[i.children])&&(n[i.children]=null),(0,_utils.eqEmptyValue)(_xeUtils.default.get(n,o))&&_xeUtils.default.set(n,o,getRowUniqueId()),n},createData:function(e){var t=this,r=this.treeConfig,i=this.treeOpts,l=function(e){return t.defineField(Object.assign({},e))},n=r?_xeUtils.default.mapTree(e,l,i):e.map(l);return this.$nextTick().then(function(){return n})},createRow:function(e){var t=this,r=_xeUtils.default.isArray(e);return r||(e=[e]),this.$nextTick().then(function(){return t.createData(e).then(function(e){return r?e:e[0]})})},revertData:function(e,i){var l=this,t=this.keepSource,n=this.tableSourceData,o=this.treeConfig;if(!t)return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.reqProp",["keep-source"]),this.$nextTick();var r=e;return e?_xeUtils.default.isArray(e)||(r=[e]):r=_xeUtils.default.toArray(this.getUpdateRecords()),r.length&&r.forEach(function(e){if(!l.isInsertByRow(e)){var t=l.getRowIndex(e);if(o&&-1===t)throw new Error(_utils.default.getLog("vxe.error.noTree",["revertData"]));var r=n[t];r&&e&&(i?_xeUtils.default.set(e,i,_xeUtils.default.clone(_xeUtils.default.get(r,i),!0)):_xeUtils.default.destructuring(e,_xeUtils.default.clone(r,!0)))}}),e?this.$nextTick():this.reloadData(n)},clearData:function(e,t){var r=this.tableFullData,i=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=r,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){i.forEach(function(e){e.property&&setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return-1<this.editStore.insertList.indexOf(e)},removeInsertRow:function(){return this.remove(this.editStore.insertList)},isUpdateByRow:function(e,t){var r=this,i=this.visibleColumn,l=this.keepSource,n=this.treeConfig,o=this.treeOpts,a=this.tableSourceData,s=this.fullDataRowIdData;if(l){var u,c,h=(0,_util.getRowid)(this,e);if(!s[h])return!1;if(n){var d=o.children,f=_xeUtils.default.findTree(a,function(e){return h===(0,_util.getRowid)(r,e)},o);e=Object.assign({},e,_defineProperty({},d,null)),f&&(u=Object.assign({},f.item,_defineProperty({},d,null)))}else{u=a[s[h].index]}if(u){if(1<arguments.length)return!eqCellValue(u,e,t);for(var g=0,v=i.length;g<v;g++)if((c=i[g].property)&&!eqCellValue(u,e,c))return!0}}return!1},getColumns:function(e){var t=this.visibleColumn;return _xeUtils.default.isUndefined(e)?t.slice(0):t[e]},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(e){var t=this.fullColumnFieldData;return t[e]?t[e].column:null},getTableColumn:function(){return{collectColumn:this.collectColumn.slice(0),fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getData:function(e){var t=this.data||this.tableSynchData;return _xeUtils.default.isUndefined(e)?t.slice(0):t[e]},getCheckboxRecords:function(e){var t=this.tableFullData,r=this.afterFullData,i=this.treeConfig,l=this.treeOpts,n=this.checkboxOpts,o=this.tableFullTreeData,a=this.afterTreeFullData,s=l.transform,u=l.children,c=l.mapChildren,h=n.checkField,d=e?s?o:t:s?a:r,f=[];if(h)f=i?_xeUtils.default.filterTree(d,function(e){return _xeUtils.default.get(e,h)},{children:s?c:u}):d.filter(function(e){return _xeUtils.default.get(e,h)});else{var g=this.selection;f=i?_xeUtils.default.filterTree(d,function(e){return-1<g.indexOf(e)},{children:s?c:u}):d.filter(function(e){return-1<g.indexOf(e)})}return f},handleVirtualTreeToList:function(){var e=this.treeOpts,t=this.treeConfig,n=this.treeExpandeds,r=this.afterTreeFullData,i=this.afterFullData;if(t&&e.transform){var o=[],a=new Map;return _xeUtils.default.eachTree(r,function(e,t,r,i,l){(!l||a.has(l)&&-1<n.indexOf(l))&&(a.set(e,1),o.push(e))},{children:e.mapChildren}),this.afterFullData=o,this.updateScrollYStatus(o),o}return i},updateAfterFullData:function(){var h=this,e=this.tableFullColumn,t=this.tableFullData,r=this.filterOpts,i=this.sortOpts,l=this.treeConfig,n=this.treeOpts,o=this.tableFullTreeData,d=r.remote,f=r.filterMethod,a=i.remote,s=i.sortMethod,u=i.multiple,c=i.chronological,g=n.transform,v=[],p=[],x=[],m=[];if(e.forEach(function(e){var t=e.property,r=e.sortable,i=e.order,l=e.filters;if(!d&&l&&l.length){var n=[],o=[];l.forEach(function(e){e.checked&&(o.push(e),n.push(e.value))}),o.length&&x.push({column:e,valueList:n,itemList:o})}!a&&r&&i&&m.push({column:e,field:e.property,property:t,order:i,sortTime:e.sortTime})}),u&&c&&1<m.length&&(m=_xeUtils.default.orderBy(m,"sortTime")),x.length){var w=function(c){return x.every(function(e){var t=e.column,r=e.valueList,i=e.itemList;if(!r.length||d)return!0;var l=t.filterMethod,n=t.filterRender,o=n?_vXETable.default.renderer.get(n.name):null,a=o&&o.renderFilter?o.filterMethod:null,s=o?o.defaultFilterMethod:null,u=_utils.default.getCellValue(c,t);return l?i.some(function(e){return l({value:e.value,option:e,cellValue:u,row:c,column:t,$table:h})}):a?i.some(function(e){return a({value:e.value,option:e,cellValue:u,row:c,column:t,$table:h})}):f?f({options:i,values:r,cellValue:u,row:c,column:t}):s?i.some(function(e){return s({value:e.value,option:e,cellValue:u,row:c,column:t,$table:h})}):-1<r.indexOf(_xeUtils.default.get(c,t.property))})};l&&g?v=p=_xeUtils.default.searchTree(o,w,_objectSpread(_objectSpread({},n),{},{original:!0})):p=v=l?o.filter(w):t.filter(w)}else l&&g?v=p=_xeUtils.default.searchTree(o,function(){return!0},_objectSpread(_objectSpread({},n),{},{original:!0})):p=v=l?o.slice(0):t.slice(0);var b=m[0];if(!a&&b)if(l&&g){if(s){var C=s({data:p,sortList:m,$table:this});p=_xeUtils.default.isArray(C)?C:p}else p=_xeUtils.default.orderBy(p,m.map(function(e){var t=e.column,r=e.order;return[getOrderField(h,t),r]}));v=p}else{if(s){var _=s({data:v,column:b.column,property:b.property,order:b.order,sortList:m,$table:this});v=_xeUtils.default.isArray(_)?_:v}else{var R;if(u)v=_xeUtils.default.orderBy(v,m.map(function(e){var t=e.column,r=e.order;return[getOrderField(h,t),r]}));else _xeUtils.default.isArray(b.sortBy)&&(R=b.sortBy.map(function(e){return[e,b.order]})),v=_xeUtils.default.orderBy(v,R||[b].map(function(e){var t=e.column,r=e.order;return[getOrderField(h,t),r]}))}p=v}this.afterFullData=v,this.afterTreeFullData=p,this.updateAfterDataIndex()},updateAfterDataIndex:function(){var s=this,e=this.treeConfig,t=this.afterFullData,u=this.fullDataRowIdData,c=this.fullAllDataRowIdData,r=this.afterTreeFullData,i=this.treeOpts;e?_xeUtils.default.eachTree(r,function(e,t,r,i){var l=(0,_util.getRowid)(s,e),n=c[l],o=i.map(function(e,t){return t%2==0?Number(e)+1:"."}).join("");if(n)n.seq=o,n._index=t;else{var a={row:e,rowid:l,seq:o,index:-1,$index:-1,_index:t,items:[],parent:null,level:0};c[l]=a,u[l]=a}},{children:i.transform?i.mapChildren:i.children}):t.forEach(function(e,t){var r=(0,_util.getRowid)(s,e),i=c[r],l=t+1;if(i)i.seq=l,i._index=t;else{var n={row:e,rowid:r,seq:l,index:-1,$index:-1,_index:t,items:[],parent:null,level:0};c[r]=n,u[r]=n}})},getParentRow:function(e){var t,r=this.treeConfig,i=this.fullDataRowIdData;if(e&&r&&(t=_xeUtils.default.isString(e)?e:(0,_util.getRowid)(this,e)))return i[t]?i[t].parent:null;return null},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,r=this.tableData,i=this.footerTableData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:r.slice(0),footerData:i.slice(0)}},handleLoadDefaults:function(){var e=this;this.checkboxConfig&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.mergeCells&&this.handleDefaultMergeCells(),this.mergeFooterItems&&this.handleDefaultMergeFooterItems(),this.$nextTick(function(){return setTimeout(e.recalculate)})},handleInitDefaults:function(){this.sortConfig&&this.handleDefaultSort()},hideColumn:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&(t.visible=!1),this.handleCustom()},showColumn:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&(t.visible=!0),this.handleCustom()},resetColumn:function(e){var t=this.customOpts.checkMethod,r=Object.assign({visible:!0,resizable:!0===e},e);return this.tableFullColumn.forEach(function(e){r.resizable&&(e.resizeWidth=0),t&&!t({column:e})||(e.visible=e.defaultVisible)}),r.resizable&&this.saveCustomResizable(!0),this.handleCustom()},handleCustom:function(){return this.saveCustomVisible(),this.analyColumnWidth(),this.refreshColumn()},restoreCustomStorage:function(){var e=this.id,t=this.collectColumn,r=this.customConfig,i=this.customOpts,l=i.storage,n=!0===i.storage,o=n||l&&l.resizable,a=n||l&&l.visible;if(r&&(o||a)){var s={};if(!e)return void(0,_log.errLog)("vxe.error.reqProp",["id"]);if(o){var u=getCustomStorageMap(resizableStorageKey)[e];u&&_xeUtils.default.each(u,function(e,t){s[t]={field:t,resizeWidth:e}})}if(a){var c=getCustomStorageMap(visibleStorageKey)[e];if(c){var h=c.split("|"),d=h[0]?h[0].split(","):[],f=h[1]?h[1].split(","):[];d.forEach(function(e){s[e]?s[e].visible=!1:s[e]={field:e,visible:!1}}),f.forEach(function(e){s[e]?s[e].visible=!0:s[e]={field:e,visible:!0}})}}var g={};_xeUtils.default.eachTree(t,function(e){var t=e.getKey();t&&(g[t]=e)}),_xeUtils.default.each(s,function(e,t){var r=e.visible,i=e.resizeWidth,l=g[t];l&&(_xeUtils.default.isNumber(i)&&(l.resizeWidth=i),_xeUtils.default.isBoolean(r)&&(l.visible=r))})}},saveCustomVisible:function(){var e=this.id,t=this.collectColumn,r=this.customConfig,i=this.customOpts,l=i.checkMethod,n=i.storage,o=!0===i.storage||n&&n.visible;if(r&&o){var a=getCustomStorageMap(visibleStorageKey),s=[],u=[];if(!e)return void(0,_log.errLog)("vxe.error.reqProp",["id"]);_xeUtils.default.eachTree(t,function(e){if(!l||l({column:e}))if(!e.visible&&e.defaultVisible){var t=e.getKey();t&&s.push(t)}else if(e.visible&&!e.defaultVisible){var r=e.getKey();r&&u.push(r)}}),a[e]=[s.join(",")].concat(u.length?[u.join(",")]:[]).join("|")||void 0,localStorage.setItem(visibleStorageKey,_xeUtils.default.toJSONString(a))}},saveCustomResizable:function(e){var t=this.id,r=this.collectColumn,i=this.customConfig,l=this.customOpts,n=l.storage,o=!0===l.storage||n&&n.resizable;if(i&&o){var a,s=getCustomStorageMap(resizableStorageKey);if(!t)return void(0,_log.errLog)("vxe.error.reqProp",["id"]);e||(a=_xeUtils.default.isPlainObject(s[t])?s[t]:{},_xeUtils.default.eachTree(r,function(e){if(e.resizeWidth){var t=e.getKey();t&&(a[t]=e.renderWidth)}})),s[t]=_xeUtils.default.isEmpty(a)?void 0:a,localStorage.setItem(resizableStorageKey,_xeUtils.default.toJSONString(s))}},refreshColumn:function(){var e=this;return this.parseColumns().then(function(){return e.refreshScroll()}).then(function(){return e.recalculate()})},parseColumns:function(){var e=this,o=[],a=[],s=[],t=this.collectColumn,r=this.tableFullColumn,i=this.isGroup,l=this.columnStore,n=this.sXOpts,u=this.scrollXStore;if(i){var c=[],h=[],d=[];_xeUtils.default.eachTree(t,function(e,t,r,i,l){var n=hasChildrenList(e);l&&l.fixed&&(e.fixed=l.fixed),l&&e.fixed!==l.fixed&&(0,_log.errLog)("vxe.error.groupFixed"),n?e.visible=!!_xeUtils.default.findTree(e.children,function(e){return hasChildrenList(e)?null:e.visible}):e.visible&&("left"===e.fixed?o.push(e):"right"===e.fixed?s.push(e):a.push(e))}),t.forEach(function(e){e.visible&&("left"===e.fixed?c.push(e):"right"===e.fixed?d.push(e):h.push(e))}),this.tableGroupColumn=c.concat(h).concat(d)}else r.forEach(function(e){e.visible&&("left"===e.fixed?o.push(e):"right"===e.fixed?s.push(e):a.push(e))});var f=o.concat(a).concat(s),g=n.enabled&&-1<n.gt&&n.gt<r.length;if(this.hasFixedColumn=0<o.length||0<s.length,Object.assign(l,{leftList:o,centerList:a,rightList:s}),g&&i&&(g=!1,"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.scrollXNotGroup")),g){"development"===process.env.NODE_ENV&&(this.showHeader&&!this.showHeaderOverflow&&(0,_log.warnLog)("vxe.error.reqProp",["show-header-overflow"]),this.showFooter&&!this.showFooterOverflow&&(0,_log.warnLog)("vxe.error.reqProp",["show-footer-overflow"]),this.spanMethod&&(0,_log.warnLog)("vxe.error.scrollErrProp",["span-method"]),this.footerSpanMethod&&(0,_log.warnLog)("vxe.error.scrollErrProp",["footer-span-method"]));var v=computeVirtualX(this).visibleSize;u.startIndex=0,u.endIndex=v,u.visibleSize=v}return f.length===this.visibleColumn.length&&this.visibleColumn.every(function(e,t){return e===f[t]})||(this.clearMergeCells(),this.clearMergeFooterItems()),this.scrollXLoad=g,this.visibleColumn=f,this.handleTableColumn(),this.updateFooter().then(function(){return e.recalculate()}).then(function(){return e.updateCellAreas(),e.recalculate()})},analyColumnWidth:function(){var e=this.columnOpts,t=e.width,r=e.minWidth,i=[],l=[],n=[],o=[],a=[],s=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),r&&!e.minWidth&&(e.minWidth=r),e.visible&&(e.resizeWidth?i.push(e):_dom.default.isPx(e.width)?l.push(e):_dom.default.isScale(e.width)?o.push(e):_dom.default.isPx(e.minWidth)?n.push(e):_dom.default.isScale(e.minWidth)?a.push(e):s.push(e))}),Object.assign(this.columnStore,{resizeList:i,pxList:l,pxMinList:n,scaleList:o,scaleMinList:a,autoList:s})},refreshScroll:function(){var t=this,r=this.lastScrollLeft,i=this.lastScrollTop,e=this.$refs,l=e.tableBody,n=e.leftBody,o=e.rightBody,a=e.tableFooter,s=l?l.$el:null,u=n?n.$el:null,c=o?o.$el:null,h=a?a.$el:null;return new Promise(function(e){if(r||i)return(0,_util.restoreScrollLocation)(t,r,i).then(function(){setTimeout(e,30)});(0,_dom.setScrollTop)(s,i),(0,_dom.setScrollTop)(u,i),(0,_dom.setScrollTop)(c,i),(0,_dom.setScrollLeft)(h,r),setTimeout(e,30)})},recalculate:function(e){var t=this,r=this.$refs,i=r.tableBody,l=r.tableHeader,n=r.tableFooter,o=i?i.$el:null,a=l?l.$el:null,s=n?n.$el:null;return o&&(this.autoCellWidth(a,o,s),!0===e)?this.computeScrollLoad().then(function(){return t.autoCellWidth(a,o,s),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,r){var i=0,l=t.clientWidth-1,n=l,o=n/100,a=this.fit,s=this.columnStore,u=s.resizeList,c=s.pxMinList,h=s.pxList,d=s.scaleList,f=s.scaleMinList,g=s.autoList;if(c.forEach(function(e){var t=parseInt(e.minWidth);i+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*o);i+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*o);i+=t,e.renderWidth=t}),h.forEach(function(e){var t=parseInt(e.width);i+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.resizeWidth);i+=t,e.renderWidth=t}),o=0<(n-=i)?Math.floor(n/(f.length+c.length+g.length)):0,a?0<n&&f.concat(c).forEach(function(e){i+=o,e.renderWidth+=o}):o=40,g.forEach(function(e){var t=Math.max(o,40);e.renderWidth=t,i+=t}),a){var v=d.concat(f).concat(c).concat(g),p=v.length-1;if(0<p){var x=l-i;if(0<x){for(;0<x&&0<=p;)x--,v[p--].renderWidth++;i=l}}}var m=t.offsetHeight,w=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=w?t.offsetWidth-t.clientWidth:0,this.overflowY=w,this.tableWidth=i,this.tableHeight=m,e?(this.headerHeight=e.clientHeight,this.$nextTick(function(){e&&t&&e.scrollLeft!==t.scrollLeft&&(e.scrollLeft=t.scrollLeft)})):this.headerHeight=0,r){var b=r.offsetHeight;this.scrollbarHeight=Math.max(b-r.clientHeight,0),this.overflowX=i>r.clientWidth,this.footerHeight=b}else this.footerHeight=0,this.scrollbarHeight=Math.max(m-t.clientHeight,0),this.overflowX=l<i;this.updateHeight(),this.parentHeight=Math.max(this.headerHeight+this.footerHeight+20,this.getParentHeight()),this.overflowX&&this.checkScrolling()},updateHeight:function(){this.customHeight=calcHeight(this,"height"),this.customMaxHeight=calcHeight(this,"maxHeight")},updateStyle:function(){var x=this,t=this.$refs,m=this.isGroup,w=this.fullColumnIdData,b=this.tableColumn,C=this.customHeight,_=this.customMaxHeight,R=this.border,y=this.headerHeight,E=this.showFooter,T=this.showOverflow,S=this.showHeaderOverflow,O=this.showFooterOverflow,k=this.footerHeight,D=this.tableHeight,I=this.tableWidth,U=this.scrollbarHeight,L=this.scrollbarWidth,$=this.scrollXLoad,M=this.scrollYLoad,A=this.cellOffsetWidth,F=this.columnStore,N=this.elemStore,e=this.editStore,r=this.currentRow,i=this.mouseConfig,V=this.keyboardConfig,H=this.keyboardOpts,q=this.spanMethod,z=this.mergeList,W=this.mergeFooterList,P=this.footerSpanMethod,B=this.isAllOverflow,j=this.visibleColumn,l=t.emptyPlaceholder,n=N["main-body-wrapper"];return l&&(l.style.top="".concat(y,"px"),l.style.height=n?"".concat(n.offsetHeight-U,"px"):""),0<C&&E&&(C+=U),["main","left","right"].forEach(function(f,e){var g=0<e?f:"",v=F["".concat(g,"List")],p=t["".concat(g,"Container")];["header","body","footer"].forEach(function(u){var e=N["".concat(f,"-").concat(u,"-wrapper")],t=N["".concat(f,"-").concat(u,"-table")];if("header"===u){var r=I,i=!1;m||g&&($||S)&&(i=!0),i&&(b=v),(i||$)&&(r=b.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=r?"".concat(r+L,"px"):"",_dom.browse.msie&&_xeUtils.default.arrayEach(t.querySelectorAll(".vxe-resizable"),function(e){e.style.height="".concat(e.parentNode.offsetHeight,"px")}));var l=N["".concat(f,"-").concat(u,"-repair")];l&&(l.style.width="".concat(I,"px"));var n=N["".concat(f,"-").concat(u,"-list")];m&&n&&_xeUtils.default.arrayEach(n.querySelectorAll(".col--group"),function(e){var t=x.getColumnNode(e);if(t){var r=t.item,i=r.showHeaderOverflow,l=_xeUtils.default.isBoolean(i)?i:S,n="title"===l||(!0===l||"tooltip"===l)||"ellipsis"===l,o=0,a=0;n&&_xeUtils.default.eachTree(r.children,function(e){e.children&&r.children.length||a++,o+=e.renderWidth}),e.style.width=n?"".concat(o-a-(R?2:0),"px"):""}})}else if("body"===u){var o=N["".concat(f,"-").concat(u,"-emptyBlock")];if(isNodeElement(e)&&(_?e.style.maxHeight="".concat(g?_-y-(E?0:U):_-y,"px"):e.style.height=0<C?"".concat(g?(0<C?C-y-k:D)-(E?0:U):C-y-k,"px"):""),p){var a="right"===g,s=F["".concat(g,"List")];isNodeElement(e)&&(e.style.top="".concat(y,"px")),p.style.height="".concat((0<C?C-y-k:D)+y+k-U*(E?2:1),"px"),p.style.width="".concat(s.reduce(function(e,t){return e+t.renderWidth},a?L:0),"px")}var c;g&&(b=$||M||(T?B:T)?z.length||q||V&&H.isMerge?j:v:j),c=b.reduce(function(e,t){return e+t.renderWidth},0),t&&(t.style.width=c?"".concat(c,"px"):"",t.style.paddingRight=L&&g&&(_dom.browse["-moz"]||_dom.browse.safari)?"".concat(L,"px"):""),o&&(o.style.width=c?"".concat(c,"px"):"")}else if("footer"===u){var h;g&&(b=$||O?W.length&&P?j:v:j),h=b.reduce(function(e,t){return e+t.renderWidth},0),isNodeElement(e)&&(p&&(e.style.top="".concat(0<C?C-k:D+y,"px")),e.style.marginTop="".concat(-U,"px")),t&&(t.style.width=h?"".concat(h+L,"px"):"")}var d=N["".concat(f,"-").concat(u,"-colgroup")];d&&_xeUtils.default.arrayEach(d.children,function(e){var t=e.getAttribute("name");if("col_gutter"===t&&(e.style.width="".concat(L,"px")),w[t]){var r,a=w[t].column,i=a.showHeaderOverflow,l=a.showFooterOverflow,n=a.showOverflow;e.style.width="".concat(a.renderWidth,"px");var s="title"===(r="header"===u?_xeUtils.default.isUndefined(i)||_xeUtils.default.isNull(i)?S:i:"footer"===u?_xeUtils.default.isUndefined(l)||_xeUtils.default.isNull(l)?O:l:_xeUtils.default.isUndefined(n)||_xeUtils.default.isNull(n)?T:n)||(!0===r||"tooltip"===r)||"ellipsis"===r,o=N["".concat(f,"-").concat(u,"-list")];"header"===u||"footer"===u?$&&!s&&(s=!0):!$&&!M||s||(s=!0),o&&_xeUtils.default.arrayEach(o.querySelectorAll(".".concat(a.id)),function(e){var t=parseInt(e.getAttribute("colspan")||1),r=e.querySelector(".vxe-cell"),i=a.renderWidth;if(r){if(1<t)for(var l=x.getColumnIndex(a),n=1;n<t;n++){var o=x.getColumns(l+n);o&&(i+=o.renderWidth)}r.style.width=s?"".concat(i-A*t,"px"):""}})}})})}),r&&this.setCurrentRow(r),i&&i.selected&&e.selected.row&&e.selected.column&&this.addColSdCls(),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,r=e.leftContainer,i=e.rightContainer,l=t?t.$el:null;l&&(r&&_dom.default[0<l.scrollLeft?"addClass":"removeClass"](r,"scrolling--middle"),i&&_dom.default[l.clientWidth<l.scrollWidth-Math.ceil(l.scrollLeft)?"addClass":"removeClass"](i,"scrolling--middle"))},preventEvent:function(t,e,r,i,l){var n,o=this;return _vXETable.default.interceptor.get(e).some(function(e){return!1===e(Object.assign({$grid:o.$xegrid,$table:o,$event:t},r))})||i&&(n=i()),l&&l(),n},handleGlobalMousedownEvent:function(i){var l=this,n=this.$el,e=this.$refs,t=this.$xegrid,r=this.$toolbar,o=this.mouseConfig,a=this.editStore,s=this.ctxMenuStore,u=this.editOpts,c=this.filterStore,h=this.getRowNode,d=a.actived,f=e.ctxWrapper,g=e.filterWrapper,v=e.validTip;if(g&&(getEventTargetNode(i,n,"vxe-cell--filter").flag||getEventTargetNode(i,g.$el).flag||getEventTargetNode(i,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(i,"event.clearFilter",c.args,this.closeFilter)),d.row){if(!1!==u.autoClear){var p=d.args.cell;p&&getEventTargetNode(i,p).flag||v&&getEventTargetNode(i,v.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&(getEventTargetNode(i,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(i,"event.clearActived",d.args,function(){var e;if("row"===u.mode){var t=getEventTargetNode(i,n,"vxe-body--row");e=!!t.flag&&h(t.targetElem).item!==d.args.row}else e=!getEventTargetNode(i,n,"col--edit").flag;if(e||(e=getEventTargetNode(i,n,"vxe-header--row").flag),e||(e=getEventTargetNode(i,n,"vxe-footer--row").flag),!e&&l.height&&!l.overflowY){var r=i.target;hasClass(r,"vxe-table--body-wrapper")&&(e=i.offsetY<r.clientHeight)}!e&&getEventTargetNode(i,n).flag||setTimeout(function(){return l.clearActived(i)})}))}}else o&&(getEventTargetNode(i,n).flag||t&&getEventTargetNode(i,t.$el).flag||f&&getEventTargetNode(i,f.$el).flag||r&&getEventTargetNode(i,r.$el).flag||(this.clearSelected(),getEventTargetNode(i,document.body,"vxe-table--ignore-areas-clear").flag||this.preventEvent(i,"event.clearAreas",{},function(){l.clearCellAreas(),l.clearCopyCellArea()})));s.visible&&f&&!getEventTargetNode(i,f.$el).flag&&this.closeMenu(),this.isActivated=getEventTargetNode(i,(t||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.closeTooltip(),this.closeMenu()},keydownEvent:function(t){var r=this,i=this.filterStore,l=this.ctxMenuStore,e=this.editStore,n=this.keyboardConfig,o=this.mouseConfig,a=this.mouseOpts,s=this.keyboardOpts,u=e.actived;27===t.keyCode&&this.preventEvent(t,"event.keydown",null,function(){if(r.emitEvent("keydown-start",{},t),n&&o&&a.area&&r.handleKeyboardEvent)r.handleKeyboardEvent(t);else if((u.row||i.visible||l.visible)&&(t.stopPropagation(),r.closeFilter(),r.closeMenu(),n&&s.isEsc&&u.row)){var e=u.args;r.clearActived(t),o&&a.selected&&r.$nextTick(function(){return r.handleSelected(e,t)})}r.emitEvent("keydown",{},t),r.emitEvent("keydown-end",{},t)})},handleGlobalKeydownEvent:function(j){var X=this;this.isActivated&&this.preventEvent(j,"event.keydown",null,function(){var e,t=X.filterStore,r=X.isCtxMenu,i=X.ctxMenuStore,l=X.editStore,n=X.editOpts,o=X.editConfig,a=X.mouseConfig,s=X.mouseOpts,u=X.keyboardConfig,c=X.keyboardOpts,h=X.treeConfig,d=X.treeOpts,f=X.highlightCurrentRow,g=X.currentRow,v=X.bodyCtxMenu,p=X.rowOpts,x=l.selected,m=l.actived,w=j.keyCode,b=8===w,C=9===w,_=13===w,R=27===w,y=32===w,E=37===w,T=38===w,S=39===w,O=40===w,k=46===w,D=113===w,I=93===w,U=j.metaKey,L=j.ctrlKey,$=j.shiftKey,M=j.altKey,A=E||T||S||O,F=r&&i.visible&&(_||y||A),N=(0,_utils.isEnableConf)(o)&&m.column&&m.row;if(t.visible)R&&X.closeFilter();else{if(F)j.preventDefault(),i.showChild&&hasChildrenList(i.selected)?X.moveCtxMenu(j,w,i,"selectChild",37,!1,i.selected.children):X.moveCtxMenu(j,w,i,"selected",39,!0,X.ctxMenuList);else if(u&&a&&s.area&&X.handleKeyboardEvent)X.handleKeyboardEvent(j);else if(u&&y&&c.isChecked&&x.row&&x.column&&("checkbox"===x.column.type||"radio"===x.column.type))j.preventDefault(),"checkbox"===x.column.type?X.handleToggleCheckRowEvent(j,x.args):X.triggerRadioRowEvent(j,x.args);else if(D&&(0,_utils.isEnableConf)(o))N||x.row&&x.column&&(j.stopPropagation(),j.preventDefault(),X.handleActived(x.args,j));else if(I)X._keyCtx=x.row&&x.column&&v.length,clearTimeout(X.keyCtxTimeout),X.keyCtxTimeout=setTimeout(function(){X._keyCtx=!1},1e3);else if(_&&!M&&u&&c.isEnter&&(x.row||m.row||h&&(p.isCurrent||f)&&g)){if(L)m.row&&(e=m.args,X.clearActived(j),a&&s.selected&&X.$nextTick(function(){return X.handleSelected(e,j)}));else if(x.row||m.row){var V=x.row?x.args:m.args;$?c.enterToTab?X.moveTabSelected(V,$,j):X.moveSelected(V,E,!0,S,!1,j):c.enterToTab?X.moveTabSelected(V,$,j):X.moveSelected(V,E,!1,S,!0,j)}else if(h&&(p.isCurrent||f)&&g){var H=g[d.children];if(H&&H.length){j.preventDefault();var q=H[0];e={$table:X,row:q},X.setTreeExpand(g,!0).then(function(){return X.scrollToRow(q)}).then(function(){return X.triggerCurrentRowEvent(j,e)})}}}else if(A&&u&&c.isArrow)N||(x.row&&x.column?X.moveSelected(x.args,E,T,S,O,j):(T||O)&&(p.isCurrent||f)&&X.moveCurrentRow(T,O,j));else if(C&&u&&c.isTab)x.row||x.column?X.moveTabSelected(x.args,$,j):(m.row||m.column)&&X.moveTabSelected(m.args,$,j);else if(u&&(k||(h&&(p.isCurrent||f)&&g?b&&c.isArrow:b))){if(!N){var z=c.delMethod,W=c.backMethod;if(c.isDel&&(x.row||x.column))z?z({row:x.row,rowIndex:X.getRowIndex(x.row),column:x.column,columnIndex:X.getColumnIndex(x.column),$table:X}):setCellValue(x.row,x.column,null),b?W?W({row:x.row,rowIndex:X.getRowIndex(x.row),column:x.column,columnIndex:X.getColumnIndex(x.column),$table:X}):X.handleActived(x.args,j):k&&X.updateFooter();else if(b&&c.isArrow&&h&&(p.isCurrent||f)&&g){var P=_xeUtils.default.findTree(X.afterFullData,function(e){return e===g},d).parent;P&&(j.preventDefault(),e={$table:X,row:P},X.setTreeExpand(P,!1).then(function(){return X.scrollToRow(P)}).then(function(){return X.triggerCurrentRowEvent(j,e)}))}}}else if(u&&c.isEdit&&!L&&!U&&(y||48<=w&&w<=57||65<=w&&w<=90||96<=w&&w<=111||186<=w&&w<=192||219<=w&&w<=222)){var B=c.editMethod;x.column&&x.row&&(0,_utils.isEnableConf)(x.column.editRender)&&(n.activeMethod&&!n.activeMethod(_objectSpread(_objectSpread({},x.args),{},{$table:X}))||(B?B({row:x.row,rowIndex:X.getRowIndex(x.row),column:x.column,columnIndex:X.getColumnIndex(x.column),$table:X}):(setCellValue(x.row,x.column,null),X.handleActived(x.args,j))))}X.emitEvent("keydown",{},j)}})},handleGlobalPasteEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,i=this.keyboardOpts,l=this.mouseConfig,n=this.mouseOpts,o=this.editStore,a=this.filterStore,s=o.actived;t&&!a.visible&&(s.row||s.column||r&&i.isClip&&l&&n.area&&this.handlePasteCellAreaEvent&&this.handlePasteCellAreaEvent(e),this.emitEvent("paste",{},e))},handleGlobalCopyEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,i=this.keyboardOpts,l=this.mouseConfig,n=this.mouseOpts,o=this.editStore,a=this.filterStore,s=o.actived;t&&!a.visible&&(s.row||s.column||r&&i.isClip&&l&&n.area&&this.handleCopyCellAreaEvent&&this.handleCopyCellAreaEvent(e),this.emitEvent("copy",{},e))},handleGlobalCutEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,i=this.keyboardOpts,l=this.mouseConfig,n=this.mouseOpts,o=this.editStore,a=this.filterStore,s=o.actived;t&&!a.visible&&(s.row||s.column||r&&i.isClip&&l&&n.area&&this.handleCutCellAreaEvent&&this.handleCutCellAreaEvent(e),this.emitEvent("cut",{},e))},handleGlobalResizeEvent:function(){this.closeMenu(),this.updateCellAreas(),this.recalculate(!0)},handleTargetEnterEvent:function(e){var t=this.$refs.tooltip;clearTimeout(this.tooltipTimeout),e?this.closeTooltip():t&&t.setActived(!0)},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts,r=this.$refs.tooltip;r&&r.setActived(!1),t.enterable?this.tooltipTimeout=setTimeout(function(){(r=e.$refs.tooltip)&&!r.isActived()&&e.closeTooltip()},t.leaveDelay):this.closeTooltip()},triggerHeaderHelpEvent:function(t,e){var r=e.column,i=r.titlePrefix||r.titleHelp;if(i.content||i.message){var l=this.$refs,n=this.tooltipStore,o=(0,_utils.getFuncText)(i.content||i.message);this.handleTargetEnterEvent(!0),n.visible=!0,n.currOpts=_objectSpread(_objectSpread({},i),{},{content:null}),this.$nextTick(function(){var e=l.tooltip;e&&e.open(t.currentTarget,o)})}},triggerHeaderTooltipEvent:function(e,t){var r=this.tooltipStore,i=t.column,l=e.currentTarget;this.handleTargetEnterEvent(r.column!==i||r.row),r.column===i&&r.visible||this.handleTooltip(e,l,l,null,t)},triggerBodyTooltipEvent:function(e,t){var r,i,l=this.editConfig,n=this.editOpts,o=this.editStore,a=this.tooltipStore,s=o.actived,u=t.row,c=t.column,h=e.currentTarget;(this.handleTargetEnterEvent(a.column!==c||a.row!==u),(0,_utils.isEnableConf)(l)&&("row"===n.mode&&s.row===u||s.row===u&&s.column===c))||(a.column===c&&a.row===u&&a.visible||(c.treeNode?(r=h.querySelector(".vxe-tree-cell"),"html"===c.type&&(i=h.querySelector(".vxe-cell--html"))):i=h.querySelector("html"===c.type?".vxe-cell--html":".vxe-cell--label"),this.handleTooltip(e,h,r||h.children[0],i,t)))},triggerFooterTooltipEvent:function(e,t){var r=t.column,i=this.tooltipStore,l=e.currentTarget;this.handleTargetEnterEvent(!0),i.column===r&&i.visible||this.handleTooltip(e,l,l.querySelector(".vxe-cell--item")||l.children[0],null,t)},handleTooltip:function(e,t,r,i,l){l.cell=t;var n=this.$refs,o=this.tooltipOpts,a=this.tooltipStore,s=l.column,u=l.row,c=o.showAll,h=o.enabled,d=o.contentMethod,f=d?d(l):null,g=d&&!_xeUtils.default.eqNull(f),v=g?f:("html"===s.type?r.innerText:r.textContent).trim(),p=r.scrollWidth>r.clientWidth;return v&&(c||h||g||p)&&(Object.assign(a,{row:u,column:s,visible:!0,currOpts:null}),this.$nextTick(function(){var e=n.tooltip;e&&e.open(p?r:i||r,_utils.default.formatText(v))})),this.$nextTick()},openTooltip:function(e,t){var r=this.$refs.commTip;return r?r.open(e,t):this.$nextTick()},closeTooltip:function(){var e=this.$refs,t=this.tooltipStore,r=e.tooltip,i=e.commTip;return t.visible&&(Object.assign(t,{row:null,column:null,content:null,visible:!1,currOpts:null}),r&&r.close()),i&&i.close(),this.$nextTick()},isAllCheckboxChecked:function(){return this.isAllSelected},isAllCheckboxIndeterminate:function(){return!this.isAllSelected&&this.isIndeterminate},isCheckboxIndeterminate:function(){return(0,_log.warnLog)("vxe.error.delFunc",["isCheckboxIndeterminate","isAllCheckboxIndeterminate"]),this.isAllCheckboxIndeterminate()},getCheckboxIndeterminateRecords:function(e){var t=this.treeConfig,r=this.treeIndeterminates,i=this.afterFullData;return t?e?r.slice(0):r.filter(function(e){return i.indexOf(e)}):[]},handleDefaultSelectionChecked:function(){var t=this.fullDataRowIdData,e=this.checkboxOpts,r=e.checkAll,i=e.checkRowKeys;if(r)this.setAllCheckboxRow(!0);else if(i){var l=[];i.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setCheckboxRow(l,!0)}},setCheckboxRow:function(e,t){var r=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return r.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByCheckboxRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):-1<this.selection.indexOf(e)},isIndeterminateByCheckboxRow:function(e){return-1<this.treeIndeterminates.indexOf(e)&&!this.isCheckedByCheckboxRow(e)},handleSelectRow:function(e,r){var i=this,l=e.row,n=this.selection,t=this.afterFullData,o=this.treeConfig,a=this.treeOpts,s=this.treeIndeterminates,u=this.checkboxOpts,c=u.checkField,h=u.checkStrictly,d=u.checkMethod;if(c)if(o&&!h){-1===r?(-1===s.indexOf(l)&&s.push(l),_xeUtils.default.set(l,c,!1)):_xeUtils.default.eachTree([l],function(t){l!==t&&d&&!d({row:t})||(_xeUtils.default.set(t,c,r),_xeUtils.default.remove(s,function(e){return e===t}),i.handleCheckboxReserveRow(l,r))},a);var f=_xeUtils.default.findTree(t,function(e){return e===l},a);if(f&&f.parent){var g,v=d?f.items.filter(function(e){return d({row:e})}):f.items;if(_xeUtils.default.find(f.items,function(e){return-1<s.indexOf(e)}))g=-1;else{var p=f.items.filter(function(e){return _xeUtils.default.get(e,c)});g=p.filter(function(e){return-1<v.indexOf(e)}).length===v.length||!(!p.length&&-1!==r)&&-1}return this.handleSelectRow({row:f.parent},g)}}else d&&!d({row:l})||(_xeUtils.default.set(l,c,r),this.handleCheckboxReserveRow(l,r));else if(o&&!h){-1===r?(-1===s.indexOf(l)&&s.push(l),_xeUtils.default.remove(n,function(e){return e===l})):_xeUtils.default.eachTree([l],function(t){l!==t&&d&&!d({row:t})||(r?n.push(t):_xeUtils.default.remove(n,function(e){return e===t}),_xeUtils.default.remove(s,function(e){return e===t}),i.handleCheckboxReserveRow(l,r))},a);var x=_xeUtils.default.findTree(t,function(e){return e===l},a);if(x&&x.parent){var m,w=d?x.items.filter(function(e){return d({row:e})}):x.items;if(_xeUtils.default.find(x.items,function(e){return-1<s.indexOf(e)}))m=-1;else{var b=x.items.filter(function(e){return-1<n.indexOf(e)});m=b.filter(function(e){return-1<w.indexOf(e)}).length===w.length||!(!b.length&&-1!==r)&&-1}return this.handleSelectRow({row:x.parent},m)}}else d&&!d({row:l})||(r?-1===n.indexOf(l)&&n.push(l):_xeUtils.default.remove(n,function(e){return e===l}),this.handleCheckboxReserveRow(l,r));this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var r=this.selection,i=this.checkboxOpts.checkField,l=t.row,n=i?!_xeUtils.default.get(l,i):-1===r.indexOf(l);e?this.triggerCheckRowEvent(e,t,n):this.handleSelectRow(t,n)},triggerCheckRowEvent:function(e,t,r){var i=this.checkboxOpts.checkMethod;i&&!i({row:t.row})||(this.handleSelectRow(t,r),this.emitEvent("checkbox-change",Object.assign({records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:r},t),e))},toggleCheckboxRow:function(e){return this.handleToggleCheckRowEvent(null,{row:e}),this.$nextTick()},setAllCheckboxRow:function(t){var r=this,i=this.afterFullData,e=this.treeConfig,l=this.treeOpts,n=this.selection,o=this.checkboxReserveRowMap,a=this.checkboxOpts,s=a.checkField,u=a.reserve,c=a.checkStrictly,h=a.checkMethod,d=[],f=e?[]:n.filter(function(e){return-1===i.indexOf(e)});if(c)this.isAllSelected=t;else{if(s){var g=function(e){h&&!h({row:e})||(t&&d.push(e),_xeUtils.default.set(e,s,t))};e?_xeUtils.default.eachTree(i,g,l):i.forEach(g)}else e?t?_xeUtils.default.eachTree(i,function(e){h&&!h({row:e})||d.push(e)},l):h&&_xeUtils.default.eachTree(i,function(e){!h({row:e})&&-1<n.indexOf(e)&&d.push(e)},l):t?d=h?i.filter(function(e){return-1<n.indexOf(e)||h({row:e})}):i.slice(0):h&&(d=i.filter(function(e){return h({row:e})?0:-1<n.indexOf(e)}));u&&(t?d.forEach(function(e){o[(0,_util.getRowid)(r,e)]=e}):i.forEach(function(e){return r.handleCheckboxReserveRow(e,!1)})),this.selection=s?[]:f.concat(d)}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.afterFullData,t=this.selection,r=this.treeIndeterminates,i=this.checkboxOpts,l=this.treeConfig,n=i.checkField,o=i.halfField,a=i.checkStrictly,s=i.checkMethod;if(!a){var u=[],c=[],h=!1,d=!1;d=n?(h=e.every(s?function(e){return s({row:e})?!!_xeUtils.default.get(e,n)&&(c.push(e),!0):(u.push(e),!0)}:function(e){return _xeUtils.default.get(e,n)})&&e.length!==u.length,l?o?!h&&e.some(function(e){return _xeUtils.default.get(e,n)||_xeUtils.default.get(e,o)||-1<r.indexOf(e)}):!h&&e.some(function(e){return _xeUtils.default.get(e,n)||-1<r.indexOf(e)}):o?!h&&e.some(function(e){return _xeUtils.default.get(e,n)||_xeUtils.default.get(e,o)}):!h&&e.some(function(e){return _xeUtils.default.get(e,n)})):(h=e.every(s?function(e){return s({row:e})?-1<t.indexOf(e)&&(c.push(e),!0):(u.push(e),!0)}:function(e){return-1<t.indexOf(e)})&&e.length!==u.length,l?!h&&e.some(function(e){return-1<r.indexOf(e)||-1<t.indexOf(e)}):!h&&e.some(function(e){return-1<t.indexOf(e)})),this.isAllSelected=h,this.isIndeterminate=d}},handleReserveStatus:function(){var e=this.expandColumn,t=this.treeOpts,r=this.treeConfig,i=this.fullDataRowIdData,l=this.fullAllDataRowMap,n=this.currentRow,o=this.selectRow,a=this.radioReserveRow,s=this.radioOpts,u=this.checkboxOpts,c=this.selection,h=this.rowExpandeds,d=this.treeExpandeds,f=this.expandOpts;if(o&&!l.has(o)&&(this.selectRow=null),s.reserve&&a){var g=(0,_util.getRowid)(this,a);i[g]&&this.setRadioRow(i[g].row)}this.selection=getRecoverRow(this,c),u.reserve&&this.setCheckboxRow(handleReserveRow(this,this.checkboxReserveRowMap),!0),n&&!l.has(n)&&(this.currentRow=null),this.rowExpandeds=e?getRecoverRow(this,h):[],e&&f.reserve&&this.setRowExpand(handleReserveRow(this,this.rowExpandedReserveRowMap),!0),this.treeExpandeds=r?getRecoverRow(this,d):[],r&&t.reserve&&this.setTreeExpand(handleReserveRow(this,this.treeExpandedReserveRowMap),!0)},getRadioReserveRecord:function(e){var t=this.fullDataRowIdData,r=this.radioReserveRow,i=this.radioOpts,l=this.afterFullData,n=this.treeConfig,o=this.treeOpts;if(i.reserve&&r){var a=(0,_util.getRowid)(this,r);if(e){if(!t[a])return r}else{var s=(0,_util.getRowkey)(this);if(n){if(_xeUtils.default.findTree(l,function(e){return a===_xeUtils.default.get(e,s)},o))return r}else if(!l.some(function(e){return a===_xeUtils.default.get(e,s)}))return r}}return null},clearRadioReserve:function(){return this.radioReserveRow=null,this.$nextTick()},handleRadioReserveRow:function(e){this.radioOpts.reserve&&(this.radioReserveRow=e)},getCheckboxReserveRecords:function(r){var t=this,i=this.fullDataRowIdData,e=this.afterFullData,l=this.checkboxReserveRowMap,n=this.checkboxOpts,o=this.treeConfig,a=this.treeOpts,s=[];if(n.reserve){var u={};o?_xeUtils.default.eachTree(e,function(e){u[(0,_util.getRowid)(t,e)]=1},a):e.forEach(function(e){u[(0,_util.getRowid)(t,e)]=1}),_xeUtils.default.each(l,function(e,t){e&&(r?i[t]||s.push(e):u[t]||s.push(e))})}return s},clearCheckboxReserve:function(){return this.checkboxReserveRowMap={},this.$nextTick()},handleCheckboxReserveRow:function(e,t){var r=this.checkboxReserveRowMap;if(this.checkboxOpts.reserve){var i=(0,_util.getRowid)(this,e);t?r[i]=e:r[i]&&delete r[i]}},triggerCheckAllEvent:function(e,t){this.setAllCheckboxRow(t),this.emitEvent("checkbox-all",{records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:t},e)},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearCheckboxRow:function(){var t=this,e=this.tableFullData,r=this.treeConfig,i=this.treeOpts,l=this.checkboxOpts,n=l.checkField,o=l.reserve;return n&&(r?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,n,!1)},i):e.forEach(function(e){return _xeUtils.default.set(e,n,!1)})),o&&e.forEach(function(e){return t.handleCheckboxReserveRow(e,!1)}),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,r=e.checkRowKey,i=e.reserve;if(r&&(t[r]&&this.setRadioRow(t[r].row),i)){var l=(0,_util.getRowkey)(this);this.radioReserveRow=_defineProperty({},l,r)}},triggerRadioRowEvent:function(e,t){var r=this.selectRow,i=this.radioOpts,l=t.row,n=r!==l;n?this.setRadioRow(l):i.strict||(n=r===l)&&(l=null,this.clearRadioRow()),n&&this.emitEvent("radio-change",_objectSpread({oldValue:r,newValue:l},t),e)},triggerCurrentRowEvent:function(e,t){var r=this.currentRow,i=t.row,l=r!==i;this.setCurrentRow(i),l&&this.emitEvent("current-change",_objectSpread({oldValue:r,newValue:i},t),e)},setCurrentRow:function(e){var t=this.$el,r=this.rowOpts;return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,(r.isCurrent||this.highlightCurrentRow)&&t&&_xeUtils.default.arrayEach(t.querySelectorAll('[rowid="'.concat((0,_util.getRowid)(this,e),'"]')),function(e){return addClass(e,"row--current")}),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},setRadioRow:function(e){var t=this.radioOpts.checkMethod;return!e||t&&!t({row:e})||(this.selectRow=e,this.handleRadioReserveRow(e)),this.$nextTick()},clearCurrentRow:function(){var e=this.$el;return this.currentRow=null,this.hoverRow=null,e&&_xeUtils.default.arrayEach(e.querySelectorAll(".row--current"),function(e){return removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRecord:function(){return this.rowOpts.isCurrent||this.highlightCurrentRow?this.currentRow:null},getRadioRecord:function(e){var t=this.treeConfig,r=this.treeOpts,i=this.selectRow,l=this.fullDataRowIdData,n=this.afterFullData;if(i){var o=(0,_util.getRowid)(this,i);if(e){if(!l[o])return i}else if(t){var a=(0,_util.getRowkey)(this);if(_xeUtils.default.findTree(n,function(e){return o===_xeUtils.default.get(e,a)},r))return i}else if(-1<n.indexOf(i))return i}return null},triggerHoverEvent:function(e,t){var r=t.row;this.setHoverRow(r)},setHoverRow:function(e){var t=this.$el,r=(0,_util.getRowid)(this,e);this.clearHoverRow(),t&&_xeUtils.default.arrayEach(t.querySelectorAll('[rowid="'.concat(r,'"]')),function(e){return addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){var e=this.$el;e&&_xeUtils.default.arrayEach(e.querySelectorAll(".vxe-body--row.row--hover"),function(e){return removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellClickEvent:function(e,t){var r=this._lastResizeTime,i=this.sortOpts,l=t.column,n=e.currentTarget,o=r&&r>Date.now()-300,a=getEventTargetNode(e,n,"vxe-cell--sort").flag,s=getEventTargetNode(e,n,"vxe-cell--filter").flag;return"cell"!==i.trigger||o||a||s||this.triggerSortEvent(e,l,getNextSortOrder(this,l)),this.emitEvent("header-cell-click",Object.assign({triggerResizable:o,triggerSort:a,triggerFilter:s,cell:n},t),e),this.columnOpts.isCurrent||this.highlightCurrentColumn?this.setCurrentColumn(l):this.$nextTick()},triggerHeaderCellDblclickEvent:function(e,t){this.emitEvent("header-cell-dblclick",Object.assign({cell:e.currentTarget},t),e)},getCurrentColumn:function(){return this.columnOpts.isCurrent||this.highlightCurrentColumn?this.currentColumn:null},setCurrentColumn:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&(this.clearCurrentRow(),this.clearCurrentColumn(),this.currentColumn=t),this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,this.$nextTick()},checkValidate:function(e){return _vXETable.default._valid?this.triggerValidate(e):this.$nextTick()},handleChangeCell:function(e,t){var r=this;this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})})},triggerCellClickEvent:function(e,t){var r=this.highlightCurrentRow,i=this.editStore,l=this.radioOpts,n=this.expandOpts,o=this.treeOpts,a=this.editConfig,s=this.editOpts,u=this.checkboxOpts,c=this.rowOpts,h=i.actived,d=t,f=d.row,g=d.column,v=g.type,p=g.treeNode,x="radio"===v,m="checkbox"===v,w="expand"===v,b=e.currentTarget,C=x&&getEventTargetNode(e,b,"vxe-cell--radio").flag,_=m&&getEventTargetNode(e,b,"vxe-cell--checkbox").flag,R=p&&getEventTargetNode(e,b,"vxe-tree--btn-wrapper").flag,y=w&&getEventTargetNode(e,b,"vxe-table--expanded").flag;t=Object.assign({cell:b,triggerRadio:C,triggerCheckbox:_,triggerTreeNode:R,triggerExpandNode:y},t),_||C||(!y&&("row"===n.trigger||w&&"cell"===n.trigger)&&this.triggerRowExpandEvent(e,t),("row"===o.trigger||p&&"cell"===o.trigger)&&this.triggerTreeExpandEvent(e,t)),R||(y||((c.isCurrent||r)&&(_||C||this.triggerCurrentRowEvent(e,t)),!C&&("row"===l.trigger||x&&"cell"===l.trigger)&&this.triggerRadioRowEvent(e,t),!_&&("row"===u.trigger||m&&"cell"===u.trigger)&&this.handleToggleCheckRowEvent(e,t)),(0,_utils.isEnableConf)(a)&&("manual"===s.trigger?h.args&&h.row===f&&g!==h.column&&this.handleChangeCell(e,t):h.args&&f===h.row&&g===h.column||("click"===s.trigger?this.handleChangeCell(e,t):"dblclick"===s.trigger&&"row"===s.mode&&h.row===f&&this.handleChangeCell(e,t)))),this.emitEvent("cell-click",t,e)},triggerCellDblclickEvent:function(e,t){var r=this,i=this.editStore,l=this.editConfig,n=this.editOpts,o=i.actived,a=e.currentTarget;t.cell=a,(0,_utils.isEnableConf)(l)&&"dblclick"===n.trigger&&(o.args&&e.currentTarget===o.args.cell||("row"===n.mode?this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})}):"cell"===n.mode&&this.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e}))),this.emitEvent("cell-dblclick",t,e)},handleDefaultSort:function(){var n=this,e=this.sortConfig,t=this.sortOpts,r=t.defaultSort;r&&(_xeUtils.default.isArray(r)||(r=[r]),r.length&&((e.multiple?r:r.slice(0,1)).forEach(function(e,t){var r=e.field,i=e.order;if(r&&i){var l=n.getColumnByField(r);l&&l.sortable&&(l.order=i,l.sortTime=Date.now()+t)}}),t.remote||this.handleTableData(!0).then(this.updateStyle)))},triggerSortEvent:function(e,t,r){var i=this.sortOpts,l=t.property;if(t.sortable||t.remoteSort){r&&t.order!==r?this.sort({field:l,order:r}):this.clearSort(i.multiple?t:null);var n={column:t,property:l,order:t.order,sortList:this.getSortColumns()};this.emitEvent("sort-change",n,e)}},sort:function(e,t){var n,o=this,r=this.sortOpts,i=r.multiple,l=r.remote,a=r.orders;return e&&_xeUtils.default.isString(e)&&(e=[{field:e,order:t}]),_xeUtils.default.isArray(e)||(e=[e]),e.length?(i||clearAllSort(this),(i?e:[e[0]]).forEach(function(e,t){var r=e.field,i=e.order,l=r;_xeUtils.default.isString(r)&&(l=o.getColumnByField(r)),l&&(l.sortable||l.remoteSort)&&(n||(n=l),-1===a.indexOf(i)&&(i=getNextSortOrder(o,l)),l.order!==i&&(l.order=i),l.sortTime=Date.now()+t)}),(!l||n&&n.remoteSort)&&this.handleTableData(!0),this.$nextTick().then(this.updateStyle)):this.$nextTick()},clearSort:function(e){var t=this.sortOpts;if(e){var r=(0,_util.handleFieldOrColumn)(this,e);r&&(r.order=null)}else clearAllSort(this);return t.remote||this.handleTableData(!0),this.$nextTick().then(this.updateStyle)},getSortColumn:function(){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["getSortColumn","getSortColumns"]),_xeUtils.default.find(this.tableFullColumn,function(e){return(e.sortable||e.remoteSort)&&e.order})},isSort:function(e){if(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&t.sortable&&!!t.order}return 0<this.getSortColumns().length},getSortColumns:function(){var e=this.sortOpts,t=e.multiple,r=e.chronological,i=[];return this.tableFullColumn.forEach(function(e){var t=e.property,r=e.order;(e.sortable||e.remoteSort)&&r&&i.push({column:e,field:e.property,property:t,order:r,sortTime:e.sortTime})}),t&&r&&1<i.length?_xeUtils.default.orderBy(i,"sortTime"):i},closeFilter:function(){var e=this.filterStore,t=e.column,r=e.visible;return Object.assign(e,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),r&&this.emitEvent("filter-visible",{column:t,property:t.property,filterList:this.getCheckedFilters(),visible:!1},null),this.$nextTick()},isFilter:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t?t.filters&&t.filters.some(function(e){return e.checked}):0<this.getCheckedFilters().length},isRowExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,r=this.expandLazyLoadeds,i=this.fullAllDataRowMap,l=e.lazy,n=i.get(t);return l&&n&&(n.expandLoaded=!1,_xeUtils.default.remove(r,function(e){return t===e})),this.$nextTick()},reloadRowExpand:function(e){var t=this,r=this.expandOpts,i=this.expandLazyLoadeds;return r.lazy&&-1===i.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},reloadExpandContent:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["reloadExpandContent","reloadRowExpand"]),this.reloadRowExpand(e)},triggerRowExpandEvent:function(e,t){var r=this.expandOpts,i=this.expandLazyLoadeds,l=this.expandColumn,n=t.row;if(!r.lazy||-1===i.indexOf(n)){var o=!this.isExpandByRow(n),a=this.getColumnIndex(l),s=this.getVMColumnIndex(l);this.setRowExpand(n,o),this.emitEvent("toggle-row-expand",{expanded:o,column:l,columnIndex:a,$columnIndex:s,row:n,rowIndex:this.getRowIndex(n),$rowIndex:this.getVMRowIndex(n)},e)}},toggleRowExpand:function(e){return this.setRowExpand(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var e=this.expandOpts,t=this.fullDataRowIdData,r=e.expandAll,i=e.expandRowKeys;if(r)this.setAllRowExpand(!0);else if(i){var l=[];i.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setRowExpand(l,!0)}},setAllRowExpand:function(e){return this.setRowExpand(this.expandOpts.lazy?this.tableData:this.tableFullData,e)},handleAsyncRowExpand:function(t){var r=this,i=this.fullAllDataRowMap.get(t);return new Promise(function(e){r.expandLazyLoadeds.push(t),r.expandOpts.loadMethod({$table:r,row:t,rowIndex:r.getRowIndex(t),$rowIndex:r.getVMRowIndex(t)}).catch(function(e){return e}).then(function(){i.expandLoaded=!0,_xeUtils.default.remove(r.expandLazyLoadeds,function(e){return e===t}),r.rowExpandeds.push(t),e(r.$nextTick().then(r.recalculate))})})},setRowExpand:function(e,t){var r=this,i=this.fullAllDataRowMap,l=this.expandLazyLoadeds,n=this.expandOpts,o=this.expandColumn,a=this.rowExpandeds,s=n.reserve,u=n.lazy,c=n.accordion,h=n.toggleMethod,d=[],f=this.getColumnIndex(o),g=this.getVMColumnIndex(o);if(e){_xeUtils.default.isArray(e)||(e=[e]),c&&(a=[],e=e.slice(e.length-1,e.length));var v=h?e.filter(function(e){return h({expanded:t,column:o,columnIndex:f,$columnIndex:g,row:e,rowIndex:r.getRowIndex(e),$rowIndex:r.getVMRowIndex(e)})}):e;t?v.forEach(function(e){if(-1===a.indexOf(e)){var t=i.get(e);u&&!t.expandLoaded&&-1===l.indexOf(e)?d.push(r.handleAsyncRowExpand(e)):a.push(e)}}):_xeUtils.default.remove(a,function(e){return-1<v.indexOf(e)}),s&&v.forEach(function(e){return r.handleRowExpandReserve(e,t)})}return this.rowExpandeds=a,Promise.all(d).then(this.recalculate)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var t=this,e=this.expandOpts,r=this.rowExpandeds,i=this.tableFullData,l=e.reserve,n=r.length;return this.rowExpandeds=[],l&&i.forEach(function(e){return t.handleRowExpandReserve(e,!1)}),this.$nextTick().then(function(){n&&t.recalculate()})},clearRowExpandReserve:function(){return this.rowExpandedReserveRowMap={},this.$nextTick()},handleRowExpandReserve:function(e,t){var r=this.rowExpandedReserveRowMap;if(this.expandOpts.reserve){var i=(0,_util.getRowid)(this,e);t?r[i]=e:r[i]&&delete r[i]}},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,r=this.treeExpandeds,i=this.fullAllDataRowMap,l=e.transform,n=e.lazy,o=i.get(t);return n&&o&&(o.treeLoaded=!1,_xeUtils.default.remove(r,function(e){return t===e})),l?(this.handleVirtualTreeToList(),this.handleTableData()):this.$nextTick()},reloadTreeExpand:function(e){var t=this,r=this.treeOpts,i=this.treeLazyLoadeds,l=r.transform,n=r.lazy,o=r.hasChild;return n&&e[o]&&-1===i.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}).then(function(){if(l)return t.handleVirtualTreeToList(),t.handleTableData()}).then(function(){return t.recalculate()}),this.$nextTick()},reloadTreeChilds:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["reloadTreeChilds","reloadTreeExpand"]),this.reloadTreeExpand(e)},triggerTreeExpandEvent:function(e,t){var r=this.treeOpts,i=this.treeLazyLoadeds,l=t.row,n=t.column;if(!r.lazy||-1===i.indexOf(l)){var o=!this.isTreeExpandByRow(l),a=this.getColumnIndex(n),s=this.getVMColumnIndex(n);this.setTreeExpand(l,o),this.emitEvent("toggle-tree-expand",{expanded:o,column:n,columnIndex:a,$columnIndex:s,row:l},e)}},toggleTreeExpand:function(e){return this.setTreeExpand(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e=this.treeConfig,r=this.treeOpts,i=this.tableFullData;if(e){var t=r.expandAll,l=r.expandRowKeys;if(t)this.setAllTreeExpand(!0);else if(l){var n=[],o=(0,_util.getRowkey)(this);l.forEach(function(t){var e=_xeUtils.default.findTree(i,function(e){return t===_xeUtils.default.get(e,o)},r);e&&n.push(e.item)}),this.setTreeExpand(n,!0)}}},handleAsyncTreeExpandChilds:function(r){var i=this,e=this.fullAllDataRowMap,l=this.treeExpandeds,t=this.treeOpts,n=this.treeLazyLoadeds,o=this.checkboxOpts,a=t.transform,s=t.loadMethod,u=o.checkStrictly,c=e.get(r);return new Promise(function(t){n.push(r),s({$table:i,row:r}).catch(function(){return[]}).then(function(e){c.treeLoaded=!0,_xeUtils.default.remove(n,function(e){return e===r}),_xeUtils.default.isArray(e)||(e=[]),e?i.loadTreeChildren(r,e).then(function(e){e.length&&-1===l.indexOf(r)&&l.push(r),!u&&i.isCheckedByCheckboxRow(r)&&i.setCheckboxRow(e,!0),i.$nextTick().then(function(){if(a)return i.handleTableData()}).then(function(){return i.recalculate()}).then(function(){return t()})}):i.$nextTick().then(function(){return i.recalculate()}).then(function(){return t()})})})},setAllTreeExpand:function(e){var t=this.tableFullData,r=this.treeOpts,i=r.lazy,l=r.children,n=[];return _xeUtils.default.eachTree(t,function(e){var t=e[l];(i||t&&t.length)&&n.push(e)},r),this.setTreeExpand(n,e)},handleBaseTreeExpand:function(e,t){var r=this,i=this.fullAllDataRowMap,l=this.tableFullData,n=this.treeExpandeds,o=this.treeOpts,a=this.treeLazyLoadeds,s=this.treeNodeColumn,u=o.reserve,c=o.lazy,h=o.hasChild,d=o.children,f=o.accordion,g=o.toggleMethod,v=[],p=this.getColumnIndex(s),x=this.getVMColumnIndex(s),m=g?e.filter(function(e){return g({expanded:t,column:s,columnIndex:p,$columnIndex:x,row:e})}):e;if(f){m=m.length?[m[m.length-1]]:[];var w=_xeUtils.default.findTree(l,function(e){return e===m[0]},o);w&&_xeUtils.default.remove(n,function(e){return-1<w.items.indexOf(e)})}return t?m.forEach(function(e){if(-1===n.indexOf(e)){var t=i.get(e);c&&e[h]&&!t.treeLoaded&&-1===a.indexOf(e)?v.push(r.handleAsyncTreeExpandChilds(e)):e[d]&&e[d].length&&n.push(e)}}):_xeUtils.default.remove(n,function(e){return-1<m.indexOf(e)}),u&&m.forEach(function(e){return r.handleTreeExpandReserve(e,t)}),Promise.all(v).then(this.recalculate)},handleVirtualTreeExpand:function(e,t){var r=this;return this.handleBaseTreeExpand(e,t).then(function(){return r.handleVirtualTreeToList(),r.handleTableData()}).then(function(){return r.recalculate()})},setTreeExpand:function(e,t){var r=this.treeOpts.transform;return e&&(_xeUtils.default.isArray(e)||(e=[e]),e.length)?r?this.handleVirtualTreeExpand(e,t):this.handleBaseTreeExpand(e,t):this.$nextTick()},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var t=this,e=this.treeOpts,r=this.treeExpandeds,i=this.tableFullData,l=e.transform,n=e.reserve,o=r.length;return this.treeExpandeds=[],n&&_xeUtils.default.eachTree(i,function(e){return t.handleTreeExpandReserve(e,!1)},e),this.handleTableData().then(function(){if(l)return t.handleVirtualTreeToList(),t.handleTableData()}).then(function(){o&&t.recalculate()})},clearTreeExpandReserve:function(){return this.treeExpandedReserveRowMap={},this.$nextTick()},handleTreeExpandReserve:function(e,t){var r=this.treeExpandedReserveRowMap;if(this.treeOpts.reserve){var i=(0,_util.getRowid)(this,e);t?r[i]=e:r[i]&&delete r[i]}},getScroll:function(){var e=this.$refs,t=this.scrollXLoad,r=this.scrollYLoad,i=e.tableBody.$el;return{virtualX:t,virtualY:r,scrollTop:i.scrollTop,scrollLeft:i.scrollLeft}},triggerScrollXEvent:function(){this.loadScrollXData()},loadScrollXData:function(){var e=this.mergeList,t=this.mergeFooterList,r=this.scrollXStore,i=r.startIndex,l=r.endIndex,n=r.offsetSize,o=computeVirtualX(this),a=o.toVisibleIndex,s=o.visibleSize,u={startIndex:Math.max(0,a-1-n),endIndex:a+s+n};calculateMergerOffserIndex(e.concat(t),u,"col");var c=u.startIndex,h=u.endIndex;(a<=i||l-s-1<=a)&&(i===c&&l===h||(r.startIndex=c,r.endIndex=h,this.updateScrollXData())),this.closeTooltip()},triggerScrollYEvent:function(e){var t=this.scrollYStore,r=t.adaptive,i=t.offsetSize,l=t.visibleSize;isWebkit&&r&&2*i+l<=40?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_xeUtils.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.mergeList,r=this.scrollYStore,i=r.startIndex,l=r.endIndex,n=r.visibleSize,o=r.offsetSize,a=r.rowHeight,s=(e.currentTarget||e.target).scrollTop,u=Math.floor(s/a),c={startIndex:Math.max(0,u-1-o),endIndex:u+n+o};calculateMergerOffserIndex(t,c,"row");var h=c.startIndex,d=c.endIndex;(u<=i||l-n-1<=u)&&(i===h&&l===d||(r.startIndex=h,r.endIndex=d,this.updateScrollYData()))},computeScrollLoad:function(){var d=this;return this.$nextTick().then(function(){var e=d.sYOpts,t=d.sXOpts,r=d.scrollXLoad,i=d.scrollYLoad,l=d.scrollXStore,n=d.scrollYStore;if(r){var o=computeVirtualX(d).visibleSize,a=t.oSize?_xeUtils.default.toNumber(t.oSize):_dom.browse.msie?10:_dom.browse.edge?5:0;l.offsetSize=a,l.visibleSize=o,l.endIndex=Math.max(l.startIndex+l.visibleSize+a,l.endIndex),d.updateScrollXData()}else d.updateScrollXSpace();var s=computeVirtualY(d),u=s.rowHeight,c=s.visibleSize;if(n.rowHeight=u,i){var h=e.oSize?_xeUtils.default.toNumber(e.oSize):_dom.browse.msie?20:_dom.browse.edge?10:0;n.offsetSize=h,n.visibleSize=c,n.endIndex=Math.max(n.startIndex+c+h,n.endIndex),d.updateScrollYData()}else d.updateScrollYSpace();d.rowHeight=u,d.$nextTick(d.updateStyle)})},handleTableColumn:function(){var e=this.scrollXLoad,t=this.visibleColumn,r=this.scrollXStore;this.tableColumn=e?t.slice(r.startIndex,r.endIndex):t.slice(0)},updateScrollXData:function(){var e=this;this.tableColumn=[],this.$nextTick(function(){e.handleTableColumn(),e.updateScrollXSpace()})},updateScrollXSpace:function(){var e=this.$refs,i=this.elemStore,t=this.visibleColumn,r=this.scrollXStore,l=this.scrollXLoad,n=this.tableWidth,o=this.scrollbarWidth,a=e.tableHeader,s=e.tableBody,u=e.tableFooter,c=s?s.$el:null;if(c){var h=a?a.$el:null,d=u?u.$el:null,f=h?h.querySelector(".vxe-table--header"):null,g=c.querySelector(".vxe-table--body"),v=d?d.querySelector(".vxe-table--footer"):null,p=t.slice(0,r.startIndex).reduce(function(e,t){return e+t.renderWidth},0),x="";l&&(x="".concat(p,"px")),f&&(f.style.marginLeft=x),g.style.marginLeft=x,v&&(v.style.marginLeft=x);["main"].forEach(function(r){["header","body","footer"].forEach(function(e){var t=i["".concat(r,"-").concat(e,"-xSpace")];t&&(t.style.width=l?"".concat(n+("header"===e?o:0),"px"):"")})}),this.$nextTick(this.updateStyle)}},updateScrollYData:function(){var e=this;this.tableData=[],this.$nextTick(function(){e.handleTableData(),e.updateScrollYSpace()})},updateScrollYSpace:function(){var i=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,r=this.afterFullData,l=e.startIndex,n=e.rowHeight,o=r.length*n,a=Math.max(0,l*n),s="",u="";t&&(s="".concat(a,"px"),u="".concat(o,"px")),["main","left","right"].forEach(function(r){var e=i["".concat(r,"-body-table")];e&&(e.style.marginTop=s),["header","body","footer"].forEach(function(e){var t=i["".concat(r,"-").concat(e,"-ySpace")];t&&(t.style.height=u)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var r=this,i=this.$refs,l=i.tableBody,n=i.rightBody,o=i.tableFooter,a=l?l.$el:null,s=n?n.$el:null,u=o?o.$el:null;return _xeUtils.default.isNumber(e)&&(0,_dom.setScrollLeft)(u||a,e),_xeUtils.default.isNumber(t)&&(0,_dom.setScrollTop)(s||a,t),this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(r.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var r=[];return e&&(this.treeConfig?r.push(this.scrollToTreeRow(e)):r.push(_dom.default.rowToVisible(this,e))),t&&r.push(this.scrollToColumn(t)),Promise.all(r)},scrollToColumn:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&this.fullColumnMap.has(t)?_dom.default.colToVisible(this,t):this.$nextTick()},scrollToTreeRow:function(t){var r=this,e=this.tableFullData,i=this.treeConfig,l=this.treeOpts,n=[];if(i){var o=_xeUtils.default.findTree(e,function(e){return e===t},l);if(o){var a=o.nodes;a.forEach(function(e,t){t<a.length-1&&!r.isTreeExpandByRow(e)&&n.push(r.setTreeExpand(e,!0))})}}return Promise.all(n).then(function(){return _dom.default.rowToVisible(r,t)})},clearScroll:function(){var e=this.$refs,t=this.scrollXStore,r=this.scrollYStore,i=e.tableBody,l=e.rightBody,n=e.tableFooter,o=i?i.$el:null,a=l?l.$el:null,s=n?n.$el:null;return a&&((0,_util.restoreScrollListener)(a),a.scrollTop=0),s&&(s.scrollLeft=0),o&&((0,_util.restoreScrollListener)(o),o.scrollTop=0,o.scrollLeft=0),t.startIndex=0,r.startIndex=0,this.$nextTick()},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,r=this.footerMethod;return e&&r&&(this.footerTableData=t.length?r({columns:t,data:this.afterFullData,$table:this,$grid:this.$xegrid}):[]),this.$nextTick()},updateStatus:function(o,a){var s=this,u=!_xeUtils.default.isUndefined(a);return this.$nextTick().then(function(){var e=s.$refs,t=s.editRules,r=s.validStore;if(o&&e.tableBody&&t){var i=o.row,l=o.column;if(s.hasCellRules("change",i,l)){var n=s.getCell(i,l);if(n)return s.validCellRules("change",i,l,a).then(function(){u&&r.visible&&setCellValue(i,l,a),s.clearValidate()}).catch(function(e){var t=e.rule;u&&setCellValue(i,l,a),s.showValidTooltip({rule:t,row:i,column:l,cell:n})})}}})},handleDefaultMergeCells:function(){this.setMergeCells(this.mergeCells)},setMergeCells:function(e){var t=this;return this.spanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-cells","span-method"]),setMerges(this,e,this.mergeList,this.afterFullData),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeCells:function(e){var t=this;this.spanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-cells","span-method"]);var r=removeMerges(this,e,this.mergeList,this.afterFullData);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeCells:function(){return this.mergeList.slice(0)},clearMergeCells:function(){return this.mergeList=[],this.$nextTick()},handleDefaultMergeFooterItems:function(){this.setMergeFooterItems(this.mergeFooterItems)},setMergeFooterItems:function(e){var t=this;return this.footerSpanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]),setMerges(this,e,this.mergeFooterList,null),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeFooterItems:function(e){var t=this;this.footerSpanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]);var r=removeMerges(this,e,this.mergeFooterList,null);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeFooterItems:function(){return this.mergeFooterList.slice(0)},clearMergeFooterItems:function(){return this.mergeFooterList=[],this.$nextTick()},updateZindex:function(){this.zIndex?this.tZindex=this.zIndex:this.tZindex<_utils.default.getLastZIndex()&&(this.tZindex=_utils.default.nextZIndex())},updateCellAreas:function(){this.mouseConfig&&this.mouseOpts.area&&this.handleUpdateCellAreas&&this.handleUpdateCellAreas()},emitEvent:function(e,t,r){this.$emit(e,Object.assign({$table:this,$grid:this.$xegrid,$event:r},t))},focus:function(){return this.isActivated=!0,this.$nextTick()},blur:function(){return this.isActivated=!1,this.$nextTick()},connect:function(e){return e&&e.syncUpdate?(e.syncUpdate({collectColumn:this.collectColumn,$table:this}),this.$toolbar=e):(0,_log.errLog)("vxe.error.barUnableLink"),this.$nextTick()},getCell:function(e,t){var r=this.$refs,i=(0,_util.getRowid)(this,e),l=r["".concat(t.fixed||"table","Body")]||r.tableBody;return l&&l.$el?l.$el.querySelector('.vxe-body--row[rowid="'.concat(i,'"] .').concat(t.id)):null},getCellLabel:function(e,t){var r=t.formatter,i=_utils.default.getCellValue(e,t),l=i;if(r){var n,o,a=this.fullAllDataRowMap,s=t.id;if(a.has(e)&&((o=(n=a.get(e)).formatData)||(o=a.get(e).formatData={}),n&&o[s]&&o[s].value===i))return o[s].label;var u={cellValue:i,row:e,rowIndex:this.getRowIndex(e),column:t,columnIndex:this.getColumnIndex(t)};if(_xeUtils.default.isString(r)){var c=_formats.formats.get(r);l=c?c(u):""}else if(_xeUtils.default.isArray(r)){var h=_formats.formats.get(r[0]);l=h?h.apply(void 0,[u].concat(_toConsumableArray(r.slice(1)))):""}else l=r(u);o&&(o[s]={value:i,label:l})}return l},getSetupOptions:function(){return _conf.default}},funcs="setFilter,openFilter,clearFilter,getCheckedFilters,closeMenu,setActiveCellArea,getActiveCellArea,getCellAreas,clearCellAreas,copyCellArea,cutCellArea,pasteCellArea,getCopyCellArea,getCopyCellAreas,clearCopyCellArea,setCellAreas,openFind,openReplace,closeFNR,getSelectedCell,clearSelected,insert,insertAt,remove,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearActived,getActiveRecord,isActiveByRow,setActiveRow,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,openExport,openPrint,exportData,openImport,importData,saveFile,readFile,importByFile,print".split(",");funcs.forEach(function(e){Methods[e]=function(){return"development"===process.env.NODE_ENV&&(this["_".concat(e)]||("openExport,openPrint,exportData,openImport,importData,saveFile,readFile,importByFile,print".split(",").includes(e)?(0,_log.errLog)("vxe.error.reqModule",["Export"]):"clearValidate,fullValidate,validate".split(",").includes(e)&&(0,_log.errLog)("vxe.error.reqModule",["Validator"]))),this["_".concat(e)]?this["_".concat(e)].apply(this,arguments):null}});var _default=Methods;exports.default=_default;