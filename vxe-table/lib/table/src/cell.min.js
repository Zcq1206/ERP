"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_dom=_interopRequireDefault(require("../../tools/dom")),_utils=_interopRequireWildcard(require("../../tools/utils")),_util=require("./util");function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function(e){return e?t:r})(e)}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var l={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=n?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(l,o,c):l[o]=e[o]}return l.default=e,t&&t.set(e,l),l}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,l)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function renderHelpIcon(e,r){var t=r.$table,l=r.column,n=l.titlePrefix||l.titleHelp;return n?[e("i",{class:["vxe-cell-help-icon",n.icon||_conf.default.icon.TABLE_HELP],on:{mouseenter:function(e){t.triggerHeaderHelpEvent(e,r)},mouseleave:function(e){t.handleTargetLeaveEvent(e)}}})]:[]}function renderTitleContent(e,r,t){var l=r.$table,n=r.column,o=n.type,c=n.showHeaderOverflow,i=l.showHeaderOverflow,a=l.tooltipOpts,d=a.showAll||a.enabled,s=_xeUtils.default.isUndefined(c)||_xeUtils.default.isNull(c)?i:c,u="title"===s,f=!0===s||"tooltip"===s,b={};return(u||f||d)&&(b.mouseenter=function(e){l._isResize||(u?_dom.default.updateCellTitle(e.currentTarget,n):(f||d)&&l.triggerHeaderTooltipEvent(e,r))}),(f||d)&&(b.mouseleave=function(e){l._isResize||(f||d)&&l.handleTargetLeaveEvent(e)}),["html"===o&&_xeUtils.default.isString(t)?e("span",{class:"vxe-cell--title",domProps:{innerHTML:t},on:b}):e("span",{class:"vxe-cell--title",on:b},t)]}function getFooterContent(e,r){var t=r.$table,l=r.column,n=r._columnIndex,o=r.items,c=l.slots,i=l.editRender,a=l.cellRender,d=i||a;if(c&&c.footer)return t.callSlot(c.footer,r,e);if(d){var s=_vXETable.default.renderer.get(d.name);if(s&&s.renderFooter)return s.renderFooter.call(t,e,d,r)}return[_utils.default.formatText(o[n],1)]}function getDefaultCellLabel(e){var r=e.$table,t=e.row,l=e.column;return _utils.default.formatText(r.getCellLabel(t,l),1)}var Cell={createColumn:function(e,r){var t=r.type,l=r.sortable,n=r.remoteSort,o=r.filters,c=r.editRender,i=r.treeNode,a=e.editConfig,d=e.editOpts,s=e.checkboxOpts,u={renderHeader:this.renderDefaultHeader,renderCell:i?this.renderTreeCell:this.renderDefaultCell,renderFooter:this.renderDefaultFooter};switch(t){case"seq":u.renderHeader=this.renderSeqHeader,u.renderCell=i?this.renderTreeIndexCell:this.renderSeqCell;break;case"radio":u.renderHeader=this.renderRadioHeader,u.renderCell=i?this.renderTreeRadioCell:this.renderRadioCell;break;case"checkbox":u.renderHeader=this.renderCheckboxHeader,u.renderCell=s.checkField?i?this.renderTreeSelectionCellByProp:this.renderCheckboxCellByProp:i?this.renderTreeSelectionCell:this.renderCheckboxCell;break;case"expand":u.renderCell=this.renderExpandCell,u.renderData=this.renderExpandData;break;case"html":u.renderCell=i?this.renderTreeHTMLCell:this.renderHTMLCell,o&&(l||n)?u.renderHeader=this.renderSortAndFilterHeader:l||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader);break;default:a&&c?(u.renderHeader=this.renderEditHeader,u.renderCell="cell"===d.mode?i?this.renderTreeCellEdit:this.renderCellEdit:i?this.renderTreeRowEdit:this.renderRowEdit):o&&(l||n)?u.renderHeader=this.renderSortAndFilterHeader:l||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader)}return(0,_util.getColumnConfig)(e,r,u)},renderHeaderTitle:function(e,r){var t=r.$table,l=r.column,n=l.slots,o=l.editRender,c=l.cellRender,i=o||c;if(n&&n.header)return renderTitleContent(e,r,t.callSlot(n.header,r,e));if(i){var a=_vXETable.default.renderer.get(i.name);if(a&&a.renderHeader)return renderTitleContent(e,r,a.renderHeader.call(t,e,i,r))}return renderTitleContent(e,r,_utils.default.formatText(l.getTitle(),1))},renderDefaultHeader:function(e,r){return renderHelpIcon(e,r).concat(Cell.renderHeaderTitle(e,r))},renderDefaultCell:function(e,r){var t=r.$table,l=r.row,n=r.column,o=n.slots,c=n.editRender,i=n.cellRender,a=c||i;if(o&&o.default)return t.callSlot(o.default,r,e);if(a){var d=c?"renderCell":"renderDefault",s=_vXETable.default.renderer.get(a.name);if(s&&s[d])return s[d].call(t,e,a,Object.assign({$type:c?"edit":"cell"},r))}var u=t.getCellLabel(l,n),f=c?c.placeholder:"";return[e("span",{class:"vxe-cell--label"},c&&(0,_utils.eqEmptyValue)(u)?[e("span",{class:"vxe-cell--placeholder"},_utils.default.formatText((0,_utils.getFuncText)(f),1))]:_utils.default.formatText(u,1))]},renderTreeCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderDefaultCell.call(this,e,r))},renderDefaultFooter:function(e,r){return[e("span",{class:"vxe-cell--item"},getFooterContent(e,r))]},renderTreeIcon:function(e,r,t){var l=r.$table,n=r.isHidden,o=l.treeOpts,c=l.treeExpandeds,i=l.treeLazyLoadeds,a=r.row,d=r.column,s=r.level,u=d.slots,f=o.children,b=o.hasChild,p=o.indent,v=o.lazy,h=o.trigger,x=o.iconLoaded,C=o.showIcon,_=o.iconOpen,T=o.iconClose,m=a[f],k=!1,E=!1,g=!1,S={};return u&&u.icon?l.callSlot(u.icon,r,e,t):(n||(E=-1<c.indexOf(a),v&&(g=-1<i.indexOf(a),k=a[b])),h&&"default"!==h||(S.click=function(e){return l.triggerTreeExpandEvent(e,r)}),[e("div",{class:["vxe-cell--tree-node",{"is--active":E}],style:{paddingLeft:"".concat(s*p,"px")}},[C&&(m&&m.length||k)?[e("div",{class:"vxe-tree--btn-wrapper",on:S},[e("i",{class:["vxe-tree--node-btn",g?x||_conf.default.icon.TABLE_TREE_LOADED:E?_||_conf.default.icon.TABLE_TREE_OPEN:T||_conf.default.icon.TABLE_TREE_CLOSE]})])]:null,e("div",{class:"vxe-tree-cell"},t)])])},renderSeqHeader:function(e,r){var t=r.$table,l=r.column,n=l.slots;return renderTitleContent(e,r,n&&n.header?t.callSlot(n.header,r,e):_utils.default.formatText(l.getTitle(),1))},renderSeqCell:function(e,r){var t=r.$table,l=r.column,n=t.treeConfig,o=t.seqOpts,c=l.slots;if(c&&c.default)return t.callSlot(c.default,r,e);var i=r.seq,a=o.seqMethod;return[_utils.default.formatText(a?a(r):n?i:(o.startIndex||0)+i,1)]},renderTreeIndexCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderSeqCell(e,r))},renderRadioHeader:function(e,r){var t=r.$table,l=r.column,n=l.slots,o=n?n.header:null,c=n?n.title:null;return renderTitleContent(e,r,o?t.callSlot(o,r,e):[e("span",{class:"vxe-radio--label"},c?t.callSlot(c,r,e):_utils.default.formatText(l.getTitle(),1))])},renderRadioCell:function(e,r){var t,l=r.$table,n=r.column,o=r.isHidden,c=l.radioOpts,i=l.selectRow,a=n.slots,d=c.labelField,s=c.checkMethod,u=c.visibleMethod,f=r.row,b=a?a.default:null,p=a?a.radio:null,v=f===i,h=!u||u({row:f}),x=!!s;o||(t={click:function(e){!x&&h&&l.triggerRadioRowEvent(e,r)}},s&&(x=!s({row:f})));var C=_objectSpread(_objectSpread({},r),{},{checked:v,disabled:x,visible:h});if(p)return l.callSlot(p,C,e);var _=[];return h&&_.push(e("span",{class:"vxe-radio--icon vxe-radio--checked-icon"}),e("span",{class:"vxe-radio--icon vxe-radio--unchecked-icon"})),(b||d)&&_.push(e("span",{class:"vxe-radio--label"},b?l.callSlot(b,C,e):_xeUtils.default.get(f,d))),[e("span",{class:["vxe-cell--radio",{"is--checked":v,"is--disabled":x}],on:t},_)]},renderTreeRadioCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderRadioCell(e,r))},renderCheckboxHeader:function(e,r){var t,l=r.$table,n=r.column,o=r.isHidden,c=l.isAllSelected,i=l.isIndeterminate,a=l.isAllCheckboxDisabled,d=n.slots,s=d?d.header:null,u=d?d.title:null,f=l.checkboxOpts,b=n.getTitle();o||(t={click:function(e){a||l.triggerCheckAllEvent(e,!c)}});var p=_objectSpread(_objectSpread({},r),{},{checked:c,disabled:a,indeterminate:i});return s?renderTitleContent(e,p,l.callSlot(s,p,e)):(f.checkStrictly?f.showHeader:!1!==f.showHeader)?renderTitleContent(e,p,[e("span",{class:["vxe-cell--checkbox",{"is--checked":c,"is--disabled":a,"is--indeterminate":i}],attrs:{title:_conf.default.i18n("vxe.table.allTitle")},on:t},[e("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(u||b?[e("span",{class:"vxe-checkbox--label"},u?l.callSlot(u,p,e):b)]:[]))]):renderTitleContent(e,p,[e("span",{class:"vxe-checkbox--label"},u?l.callSlot(u,p,e):b)])},renderCheckboxCell:function(e,r){var t,l=r.$table,n=r.row,o=r.column,c=r.isHidden,i=l.treeConfig,a=l.treeIndeterminates,d=l.checkboxOpts,s=d.labelField,u=d.checkMethod,f=d.visibleMethod,b=o.slots,p=b?b.default:null,v=b?b.checkbox:null,h=!1,x=!1,C=!f||f({row:n}),_=!!u;c||(x=-1<l.selection.indexOf(n),t={click:function(e){!_&&C&&l.triggerCheckRowEvent(e,r,!x)}},u&&(_=!u({row:n})),i&&(h=-1<a.indexOf(n)));var T=_objectSpread(_objectSpread({},r),{},{checked:x,disabled:_,visible:C,indeterminate:h});if(v)return l.callSlot(v,T,e);var m=[];return C&&m.push(e("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})),(p||s)&&m.push(e("span",{class:"vxe-checkbox--label"},p?l.callSlot(p,T,e):_xeUtils.default.get(n,s))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":x,"is--disabled":_,"is--indeterminate":h}],on:t},m)]},renderTreeSelectionCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderCheckboxCell(e,r))},renderCheckboxCellByProp:function(e,r){var t,l=r.$table,n=r.row,o=r.column,c=r.isHidden,i=l.treeConfig,a=l.treeIndeterminates,d=l.checkboxOpts,s=d.labelField,u=d.checkField,f=d.halfField,b=d.checkMethod,p=d.visibleMethod,v=o.slots,h=v?v.default:null,x=v?v.checkbox:null,C=!1,_=!1,T=!p||p({row:n}),m=!!b;c||(_=_xeUtils.default.get(n,u),t={click:function(e){!m&&T&&l.triggerCheckRowEvent(e,r,!_)}},b&&(m=!b({row:n})),i&&(C=-1<a.indexOf(n)));var k=_objectSpread(_objectSpread({},r),{},{checked:_,disabled:m,visible:T,indeterminate:C});if(x)return l.callSlot(x,k,e);var E=[];return T&&E.push(e("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})),(h||s)&&E.push(e("span",{class:"vxe-checkbox--label"},h?l.callSlot(h,k,e):_xeUtils.default.get(n,s))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":_,"is--disabled":m,"is--indeterminate":f&&!_?n[f]:C}],on:t},E)]},renderTreeSelectionCellByProp:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderCheckboxCellByProp(e,r))},renderExpandCell:function(e,r){var t=r.$table,l=r.isHidden,n=r.row,o=r.column,c=t.expandOpts,i=t.rowExpandeds,a=t.expandLazyLoadeds,d=c.lazy,s=c.labelField,u=c.iconLoaded,f=c.showIcon,b=c.iconOpen,p=c.iconClose,v=c.visibleMethod,h=o.slots,x=h?h.default:null,C=!1,_=!1;return h&&h.icon?t.callSlot(h.icon,r,e):(l||(C=-1<i.indexOf(r.row),d&&(_=-1<a.indexOf(n))),[!f||v&&!v(r)?null:e("span",{class:["vxe-table--expanded",{"is--active":C}],on:{click:function(e){t.triggerRowExpandEvent(e,r)}}},[e("i",{class:["vxe-table--expand-btn",_?u||_conf.default.icon.TABLE_EXPAND_LOADED:C?b||_conf.default.icon.TABLE_EXPAND_OPEN:p||_conf.default.icon.TABLE_EXPAND_CLOSE]})]),x||s?e("span",{class:"vxe-table--expand-label"},x?t.callSlot(x,r,e):_xeUtils.default.get(n,s)):null])},renderExpandData:function(e,r){var t=r.$table,l=r.column,n=l.slots,o=l.contentRender;if(n&&n.content)return t.callSlot(n.content,r,e);if(o){var c=_vXETable.default.renderer.get(o.name);if(c&&c.renderExpand)return c.renderExpand.call(t,e,o,r)}return[]},renderHTMLCell:function(e,r){var t=r.$table,l=r.column.slots;return l&&l.default?t.callSlot(l.default,r,e):[e("span",{class:"vxe-cell--html",domProps:{innerHTML:getDefaultCellLabel(r)}})]},renderTreeHTMLCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderHTMLCell(e,r))},renderSortAndFilterHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderSortIcon(e,r)).concat(Cell.renderFilterIcon(e,r))},renderSortHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderSortIcon(e,r))},renderSortIcon:function(e,r){var t=r.$table,l=r.column,n=t.sortOpts,o=n.showIcon,c=n.iconAsc,i=n.iconDesc;return o?[e("span",{class:"vxe-cell--sort"},[e("i",{class:["vxe-sort--asc-btn",c||_conf.default.icon.TABLE_SORT_ASC,{"sort--active":"asc"===l.order}],attrs:{title:_conf.default.i18n("vxe.table.sortAsc")},on:{click:function(e){t.triggerSortEvent(e,l,"asc")}}}),e("i",{class:["vxe-sort--desc-btn",i||_conf.default.icon.TABLE_SORT_DESC,{"sort--active":"desc"===l.order}],attrs:{title:_conf.default.i18n("vxe.table.sortDesc")},on:{click:function(e){t.triggerSortEvent(e,l,"desc")}}})])]:[]},renderFilterHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderFilterIcon(e,r))},renderFilterIcon:function(e,r){var t=r.$table,l=r.column,n=r.hasFilter,o=t.filterStore,c=t.filterOpts,i=c.showIcon,a=c.iconNone,d=c.iconMatch;return i?[e("span",{class:["vxe-cell--filter",{"is--active":o.visible&&o.column===l}]},[e("i",{class:["vxe-filter--btn",n?d||_conf.default.icon.TABLE_FILTER_MATCH:a||_conf.default.icon.TABLE_FILTER_NONE],attrs:{title:_conf.default.i18n("vxe.table.filter")},on:{click:function(e){t.triggerFilterEvent(e,r.column,r)}}})])]:[]},renderEditHeader:function(e,r){var t=r.$table,l=r.column,n=t.editConfig,o=t.editRules,c=t.editOpts,i=l.sortable,a=l.remoteSort,d=l.filters,s=l.editRender,u=!1;if(o){var f=_xeUtils.default.get(o,r.column.property);f&&(u=f.some(function(e){return e.required}))}return((0,_utils.isEnableConf)(n)?[u&&c.showAsterisk?e("i",{class:"vxe-cell--required-icon"}):null,(0,_utils.isEnableConf)(s)&&c.showIcon?e("i",{class:["vxe-cell--edit-icon",c.icon||_conf.default.icon.TABLE_EDIT]}):null]:[]).concat(Cell.renderDefaultHeader(e,r)).concat(i||a?Cell.renderSortIcon(e,r):[]).concat(d?Cell.renderFilterIcon(e,r):[])},renderRowEdit:function(e,r){var t=r.$table,l=r.column.editRender,n=t.editStore.actived;return Cell.runRenderer(e,r,this,(0,_utils.isEnableConf)(l)&&n&&n.row===r.row)},renderTreeRowEdit:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderRowEdit(e,r))},renderCellEdit:function(e,r){var t=r.$table,l=r.column.editRender,n=t.editStore.actived;return Cell.runRenderer(e,r,this,(0,_utils.isEnableConf)(l)&&n&&n.row===r.row&&n.column===r.column)},renderTreeCellEdit:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderCellEdit(e,r))},runRenderer:function(e,r,t,l){var n=r.$table,o=r.column,c=o.slots,i=o.editRender,a=o.formatter,d=_vXETable.default.renderer.get(i.name);return l?c&&c.edit?n.callSlot(c.edit,r,e):d&&d.renderEdit?d.renderEdit.call(n,e,i,Object.assign({$type:"edit"},r)):[]:c&&c.default?n.callSlot(c.default,r,e):a?[e("span",{class:"vxe-cell--label"},[getDefaultCellLabel(r)])]:Cell.renderDefaultCell.call(t,e,r)}},_default=exports.Cell=Cell;exports.default=_default;